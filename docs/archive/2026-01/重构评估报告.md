# æŒ‰é¡¹ç›®è§„èŒƒé‡æ„è¯„ä¼°æŠ¥å‘Š

## ğŸ“Š æ€»ä½“è¯„ä¼°

**å¯è¡Œæ€§ï¼š** âœ… **å¯è¡Œï¼Œä½†éœ€è¦å¤§é‡é‡æ„å·¥ä½œ**

**æ¨èåº¦ï¼š** â­â­â­â­ (4/5)

**å·¥ä½œé‡ï¼š** ä¸­ç­‰åå¤§ï¼ˆé¢„è®¡ 2-3 å‘¨ï¼‰

---

## ğŸ” å½“å‰æ¶æ„åˆ†æ

### å½“å‰ç»“æ„
```
frontend/
â”œâ”€â”€ app/
â”‚   â””â”€â”€ api/              # API Routesï¼ˆè·¯ç”±å±‚ï¼‰
â”‚       â”œâ”€â”€ bodypart/
â”‚       â”œâ”€â”€ exercise/
â”‚       â”œâ”€â”€ workout/
â”‚       â””â”€â”€ ...
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ db/
â”‚   â”‚   â”œâ”€â”€ schema.ts     # æ•°æ®åº“ Schemaï¼ˆDrizzleï¼‰
â”‚   â”‚   â””â”€â”€ index.ts      # æ•°æ®åº“è¿æ¥
â”‚   â”œâ”€â”€ auth.ts           # è®¤è¯é€»è¾‘
â”‚   â””â”€â”€ auth-helpers.ts   # è®¤è¯è¾…åŠ©å‡½æ•°
â””â”€â”€ components/           # UI ç»„ä»¶
```

### å½“å‰é—®é¢˜

1. **âŒ æ²¡æœ‰åˆ†å±‚æ¶æ„**
   - ä¸šåŠ¡é€»è¾‘ç›´æ¥å†™åœ¨ API Routes ä¸­
   - æ•°æ®åº“æ“ä½œç›´æ¥åœ¨è·¯ç”±å±‚æ‰§è¡Œ
   - æ²¡æœ‰é¢†åŸŸæ¨¡å‹ã€æœåŠ¡å±‚ã€ä»“å‚¨å±‚

2. **âŒ èŒè´£æ··ä¹±**
   - API Routes åŒæ—¶å¤„ç†ï¼š
     - HTTP è¯·æ±‚/å“åº”
     - ä¸šåŠ¡è§„åˆ™éªŒè¯ï¼ˆå¦‚ï¼šæ£€æŸ¥é‡å¤åç§°ï¼‰
     - æ•°æ®åº“æŸ¥è¯¢
     - é”™è¯¯å¤„ç†

3. **âŒ ä»£ç é‡å¤**
   - æ¯ä¸ª API route éƒ½æœ‰ç›¸ä¼¼çš„é”™è¯¯å¤„ç†é€»è¾‘
   - æ•°æ®åº“æŸ¥è¯¢é€»è¾‘é‡å¤ï¼ˆå¦‚ï¼šæ£€æŸ¥ç”¨æˆ·æƒé™ã€æŸ¥æ‰¾å®ä½“ï¼‰

4. **âŒ éš¾ä»¥æµ‹è¯•**
   - ä¸šåŠ¡é€»è¾‘ä¸ HTTP å±‚è€¦åˆ
   - æ— æ³•å•ç‹¬æµ‹è¯•ä¸šåŠ¡è§„åˆ™

5. **âŒ ä¸ç¬¦åˆè§„èŒƒ**
   - æ–‡ä»¶å‘½åï¼šéƒ¨åˆ†ä½¿ç”¨ camelCaseï¼ˆå¦‚ `auth-helpers.ts`ï¼‰
   - ç›®å½•ç»“æ„ï¼šä¸ç¬¦åˆ DDD ç»“æ„
   - é”™è¯¯å¤„ç†ï¼šæ²¡æœ‰ç»Ÿä¸€çš„ Result ç±»å‹

---

## âœ… ç¬¦åˆè§„èŒƒçš„ä¼˜åŠ¿

### 1. åˆ†å±‚æ¸…æ™°
- **Model å±‚**ï¼šå°è£…ä¸šåŠ¡è§„åˆ™ï¼ˆå¦‚ï¼šBodyPart åç§°å”¯ä¸€æ€§ï¼‰
- **Service å±‚**ï¼šçº¯ä¸šåŠ¡é€»è¾‘ï¼ˆå¦‚ï¼šéªŒè¯è®­ç»ƒæ•°æ®ï¼‰
- **Application å±‚**ï¼šåè°ƒå„å±‚ï¼Œå¤„ç†å®Œæ•´ç”¨ä¾‹
- **Repository å±‚**ï¼šæ•°æ®è®¿é—®ï¼ŒCQRS åˆ†ç¦»

### 2. å¯æµ‹è¯•æ€§
- æ¯å±‚å¯ç‹¬ç«‹æµ‹è¯•
- ä¸šåŠ¡é€»è¾‘ä¸ä¾èµ– HTTP å±‚
- æ˜“äº Mock å’Œå•å…ƒæµ‹è¯•

### 3. å¯ç»´æŠ¤æ€§
- èŒè´£æ¸…æ™°ï¼Œæ˜“äºç†è§£
- ä»£ç å¤ç”¨æ€§é«˜
- æ˜“äºæ‰©å±•æ–°åŠŸèƒ½

### 4. ç¬¦åˆè§„èŒƒ
- ç»Ÿä¸€çš„å‘½åè§„èŒƒ
- ç»Ÿä¸€çš„é”™è¯¯å¤„ç†
- ç»Ÿä¸€çš„ä»£ç ç»„ç»‡

---

## ğŸ“‹ é‡æ„æ–¹æ¡ˆ

### ç›®æ ‡ç»“æ„ï¼ˆæŒ‰è§„èŒƒï¼‰

```
frontend/
â”œâ”€â”€ domain/
â”‚   â”œâ”€â”€ shared/
â”‚   â”‚   â””â”€â”€ error-types.ts        # ç»Ÿä¸€é”™è¯¯ç±»å‹
â”‚   â”œâ”€â”€ bodypart/
â”‚   â”‚   â”œâ”€â”€ application/
â”‚   â”‚   â”‚   â””â”€â”€ bodypart.use-case.ts
â”‚   â”‚   â””â”€â”€ repository/
â”‚   â”‚       â”œâ”€â”€ commands/
â”‚   â”‚       â”‚   â””â”€â”€ bodypart.repository.ts
â”‚   â”‚       â””â”€â”€ queries/
â”‚   â”‚           â””â”€â”€ bodypart.repository.ts
â”‚   â”œâ”€â”€ exercise/
â”‚   â”‚   â”œâ”€â”€ application/
â”‚   â”‚   â”‚   â””â”€â”€ exercise.use-case.ts
â”‚   â”‚   â””â”€â”€ repository/
â”‚   â”‚       â”œâ”€â”€ commands/
â”‚   â”‚       â””â”€â”€ queries/
â”‚   â”œâ”€â”€ workout/
â”‚   â”‚   â”œâ”€â”€ application/
â”‚   â”‚   â””â”€â”€ repository/
â”‚   â””â”€â”€ ...
â”œâ”€â”€ app/
â”‚   â””â”€â”€ api/                      # ä»…å¤„ç† HTTP
â”‚       â”œâ”€â”€ bodypart/
â”‚       â”‚   â””â”€â”€ route.ts           # è°ƒç”¨ Application Service
â”‚       â””â”€â”€ ...
â””â”€â”€ lib/
    â””â”€â”€ db/
        â””â”€â”€ schema.ts             # ä¿æŒä¸å˜
```

### é‡æ„æ­¥éª¤

#### é˜¶æ®µ 1ï¼šåŸºç¡€è®¾æ–½ï¼ˆ1-2 å¤©ï¼‰
1. âœ… åˆ›å»º `domain/shared/error-types.ts`
   - å®šä¹‰ `ErrorCode`ã€`UseCaseError`ã€`Result` ç±»å‹
   - åˆ›å»ºé”™è¯¯è¾…åŠ©å‡½æ•°

2. âœ… é…ç½®è·¯å¾„åˆ«å
   - æ›´æ–° `tsconfig.json` æ·»åŠ  `@domain/*` åˆ«å

#### é˜¶æ®µ 2ï¼šé‡æ„ä¸€ä¸ªé¢†åŸŸä½œä¸ºç¤ºä¾‹ï¼ˆ3-4 å¤©ï¼‰
é€‰æ‹© `bodypart` ä½œä¸ºç¬¬ä¸€ä¸ªé‡æ„çš„é¢†åŸŸï¼š

1. âœ… åˆ›å»º Repository å±‚
   - `domain/bodypart/repository/queries/bodypart.repository.ts`
   - `domain/bodypart/repository/commands/bodypart.repository.ts`

2. âœ… åˆ›å»º Application Service
   - `domain/bodypart/application/bodypart.use-case.ts`
   - å®ç°æ‰€æœ‰ç”¨ä¾‹ï¼ˆåˆ›å»ºã€æŸ¥è¯¢ã€æ›´æ–°ã€åˆ é™¤ï¼‰

3. âœ… é‡æ„ API Route
   - `app/api/bodypart/route.ts` ä»…è°ƒç”¨ Application Service
   - å°† Result è½¬æ¢ä¸º HTTP å“åº”

4. âœ… ç¼–å†™æµ‹è¯•
   - å•å…ƒæµ‹è¯• Repository
   - å•å…ƒæµ‹è¯• Application Service
   - é›†æˆæµ‹è¯• API Route

#### é˜¶æ®µ 3ï¼šé‡æ„å…¶ä»–é¢†åŸŸï¼ˆ5-7 å¤©ï¼‰
æŒ‰ç›¸åŒæ¨¡å¼é‡æ„ï¼š
- `exercise`
- `workout`
- `workoutset`
- `set`

#### é˜¶æ®µ 4ï¼šä¼˜åŒ–å’Œæ–‡æ¡£ï¼ˆ2-3 å¤©ï¼‰
1. ä»£ç å®¡æŸ¥
2. æ€§èƒ½ä¼˜åŒ–
3. æ›´æ–°æ–‡æ¡£

---

## ğŸ¯ å…·ä½“é‡æ„ç¤ºä¾‹

### å½“å‰ä»£ç ï¼ˆä¸ç¬¦åˆè§„èŒƒï¼‰

```typescript
// app/api/bodypart/route.ts
export async function POST(request: NextRequest) {
  try {
    const user = await requireAuth();
    const body = await request.json();
    const data = bodyPartSchema.parse(body);

    // ä¸šåŠ¡é€»è¾‘ç›´æ¥å†™åœ¨è·¯ç”±å±‚
    const existing = await db
      .select()
      .from(bodyParts)
      .where(and(
        eq(bodyParts.userId, user.id),
        eq(bodyParts.name, data.name)
      ))
      .limit(1);

    if (existing.length > 0) {
      return NextResponse.json(
        { error: 'Body part with this name already exists' },
        { status: 400 }
      );
    }

    const [result] = await db
      .insert(bodyParts)
      .values({
        userId: user.id,
        name: data.name,
      })
      .returning();

    return NextResponse.json(result);
  } catch (error: any) {
    // é”™è¯¯å¤„ç†é‡å¤
    if (error instanceof z.ZodError) {
      return NextResponse.json({ error: error.errors }, { status: 400 });
    }
    return NextResponse.json({ error: error.message }, { status: 500 });
  }
}
```

### é‡æ„åï¼ˆç¬¦åˆè§„èŒƒï¼‰

```typescript
// domain/bodypart/repository/queries/bodypart.repository.ts
export async function findBodyPartByName(
  userId: string,
  name: string
): Promise<BodyPart | null> {
  const [result] = await db
    .select()
    .from(bodyParts)
    .where(and(
      eq(bodyParts.userId, userId),
      eq(bodyParts.name, name)
    ))
    .limit(1);
  
  return result || null;
}

// domain/bodypart/repository/commands/bodypart.repository.ts
export async function insertBodyPart(
  userId: string,
  name: string
): Promise<BodyPart> {
  const [result] = await db
    .insert(bodyParts)
    .values({ userId, name })
    .returning();
  
  return result;
}

// domain/bodypart/application/bodypart.use-case.ts
export async function createBodyPart(
  userId: string,
  name: string
): Promise<Result<BodyPart>> {
  try {
    // ä¸šåŠ¡è§„åˆ™éªŒè¯
    const existing = await findBodyPartByName(userId, name);
    if (existing) {
      return {
        success: false,
        error: {
          code: 'BODY_PART_ALREADY_EXISTS',
          message: 'Body part with this name already exists',
        },
      };
    }

    // åˆ›å»º
    const bodyPart = await insertBodyPart(userId, name);
    
    return {
      success: true,
      data: bodyPart,
    };
  } catch (error) {
    return {
      success: false,
      error: {
        code: 'INTERNAL_ERROR',
        message: 'Failed to create body part',
      },
    };
  }
}

// app/api/bodypart/route.ts
export async function POST(request: NextRequest) {
  const user = await requireAuth();
  if (!user) {
    return NextResponse.json(
      { error: 'Unauthorized' },
      { status: 401 }
    );
  }

  const body = await request.json();
  const data = bodyPartSchema.parse(body);

  const result = await createBodyPart(user.id, data.name);

  if (!result.success) {
    const statusCode = getStatusCode(result.error.code);
    return NextResponse.json(
      { error: result.error.message },
      { status: statusCode }
    );
  }

  return NextResponse.json(result.data);
}
```

---

## âš ï¸ æŒ‘æˆ˜å’Œé£é™©

### 1. å·¥ä½œé‡è¾ƒå¤§
- **é£é™©**ï¼šéœ€è¦é‡æ„æ‰€æœ‰ API routesï¼ˆ20+ ä¸ªï¼‰
- **ç¼“è§£**ï¼šåˆ†é˜¶æ®µè¿›è¡Œï¼Œå…ˆé‡æ„ä¸€ä¸ªé¢†åŸŸä½œä¸ºç¤ºä¾‹

### 2. å­¦ä¹ æ›²çº¿
- **é£é™©**ï¼šå›¢é˜Ÿéœ€è¦ç†è§£ DDD å’Œåˆ†å±‚æ¶æ„
- **ç¼“è§£**ï¼šæä¾›è¯¦ç»†æ–‡æ¡£å’Œç¤ºä¾‹ä»£ç 

### 3. å¯èƒ½å½±å“ç°æœ‰åŠŸèƒ½
- **é£é™©**ï¼šé‡æ„è¿‡ç¨‹ä¸­å¯èƒ½å¼•å…¥ bug
- **ç¼“è§£**ï¼š
  - ç¼–å†™æµ‹è¯•è¦†ç›–
  - åˆ†é˜¶æ®µé‡æ„ï¼Œæ¯ä¸ªé˜¶æ®µéƒ½è¿›è¡Œæµ‹è¯•
  - ä¿æŒ API æ¥å£ä¸å˜

### 4. Next.js App Router é™åˆ¶
- **é£é™©**ï¼šNext.js çš„æ–‡ä»¶è·¯ç”±ç³»ç»Ÿå¯èƒ½ä¸ DDD ç»“æ„å†²çª
- **ç¼“è§£**ï¼š
  - API Routes ä¿æŒåœ¨ `app/api/` ä¸‹ï¼ˆç¬¦åˆ Next.js è§„èŒƒï¼‰
  - ä¸šåŠ¡é€»è¾‘æ”¾åœ¨ `domain/` ä¸‹ï¼ˆç¬¦åˆé¡¹ç›®è§„èŒƒï¼‰
  - ä¸¤è€…ä¸å†²çª

---

## ğŸ’¡ å»ºè®®

### æ¨èæ–¹æ¡ˆï¼šæ¸è¿›å¼é‡æ„

1. **âœ… ç«‹å³å¼€å§‹**
   - åˆ›å»ºåŸºç¡€è®¾æ–½ï¼ˆé”™è¯¯ç±»å‹ã€è·¯å¾„åˆ«åï¼‰
   - é€‰æ‹©ä¸€ä¸ªç®€å•é¢†åŸŸï¼ˆå¦‚ `bodypart`ï¼‰ä½œä¸ºç¤ºä¾‹

2. **âœ… éªŒè¯å¯è¡Œæ€§**
   - å®Œæˆä¸€ä¸ªé¢†åŸŸçš„é‡æ„
   - ç¼–å†™æµ‹è¯•éªŒè¯
   - è¯„ä¼°æ•ˆæœ

3. **âœ… é€æ­¥æ¨å¹¿**
   - å¦‚æœæ•ˆæœè‰¯å¥½ï¼Œç»§ç»­é‡æ„å…¶ä»–é¢†åŸŸ
   - å¦‚æœé‡åˆ°é—®é¢˜ï¼ŒåŠæ—¶è°ƒæ•´æ–¹æ¡ˆ

### ä¸æ¨èæ–¹æ¡ˆ

1. **âŒ ä¸€æ¬¡æ€§é‡æ„æ‰€æœ‰ä»£ç **
   - é£é™©å¤ªå¤§ï¼Œå®¹æ˜“å¼•å…¥ bug
   - éš¾ä»¥å›æ»š

2. **âŒ ä¿æŒç°çŠ¶**
   - ä»£ç è´¨é‡ä¼šæŒç»­ä¸‹é™
   - ä¸ç¬¦åˆé¡¹ç›®è§„èŒƒ
   - éš¾ä»¥ç»´æŠ¤å’Œæ‰©å±•

---

## ğŸ“ˆ é¢„æœŸæ”¶ç›Š

### çŸ­æœŸï¼ˆ1-2 å‘¨ï¼‰
- âœ… ä»£ç ç»“æ„æ›´æ¸…æ™°
- âœ… ç¬¦åˆé¡¹ç›®è§„èŒƒ
- âœ… æé«˜ä»£ç å¯è¯»æ€§

### ä¸­æœŸï¼ˆ1-2 ä¸ªæœˆï¼‰
- âœ… æé«˜å¼€å‘æ•ˆç‡ï¼ˆä»£ç å¤ç”¨ï¼‰
- âœ… é™ä½ bug ç‡ï¼ˆèŒè´£æ¸…æ™°ï¼‰
- âœ… æ˜“äºæ·»åŠ æ–°åŠŸèƒ½

### é•¿æœŸï¼ˆ3+ ä¸ªæœˆï¼‰
- âœ… æé«˜ä»£ç è´¨é‡
- âœ… é™ä½ç»´æŠ¤æˆæœ¬
- âœ… å›¢é˜Ÿåä½œæ›´é¡ºç•…

---

## ğŸ¬ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

### å¦‚æœå†³å®šé‡æ„ï¼š

1. **åˆ›å»º TODO æ¸…å•**
   - [ ] åˆ›å»º `domain/shared/error-types.ts`
   - [ ] é…ç½®è·¯å¾„åˆ«å
   - [ ] é‡æ„ `bodypart` é¢†åŸŸï¼ˆä½œä¸ºç¤ºä¾‹ï¼‰
   - [ ] ç¼–å†™æµ‹è¯•
   - [ ] è¯„ä¼°æ•ˆæœ
   - [ ] å†³å®šæ˜¯å¦ç»§ç»­

2. **å‡†å¤‡å·¥å…·**
   - ç¡®ä¿æµ‹è¯•æ¡†æ¶å·²é…ç½®
   - å‡†å¤‡ä»£ç å®¡æŸ¥æµç¨‹

3. **å›¢é˜Ÿæ²Ÿé€š**
   - è§£é‡Šé‡æ„åŸå› å’Œæ–¹æ¡ˆ
   - ç¡®ä¿å›¢é˜Ÿç†è§£ DDD æ¦‚å¿µ

---

## ğŸ“ æ€»ç»“

**ç»“è®ºï¼š** æŒ‰é¡¹ç›®è§„èŒƒé‡æ„æ˜¯**å¯è¡Œä¸”æ¨èçš„**ï¼Œä½†éœ€è¦ï¼š

1. âœ… **åˆ†é˜¶æ®µè¿›è¡Œ**ï¼šå…ˆåšç¤ºä¾‹ï¼ŒéªŒè¯å¯è¡Œæ€§
2. âœ… **ä¿æŒ API ä¸å˜**ï¼šä¸å½±å“ç°æœ‰åŠŸèƒ½
3. âœ… **ç¼–å†™æµ‹è¯•**ï¼šç¡®ä¿é‡æ„è´¨é‡
4. âœ… **å›¢é˜Ÿåä½œ**ï¼šç¡®ä¿å›¢é˜Ÿç†è§£æ–°æ¶æ„

**å»ºè®®ï¼š** ä» `bodypart` é¢†åŸŸå¼€å§‹ï¼Œä½œä¸ºé‡æ„ç¤ºä¾‹ï¼ŒéªŒè¯æ–¹æ¡ˆå¯è¡Œæ€§åå†å†³å®šæ˜¯å¦å…¨é¢é‡æ„ã€‚

---

**è¯„ä¼°æ—¥æœŸï¼š** 2024å¹´12æœˆ31æ—¥  
**è¯„ä¼°äººï¼š** AI Assistant  
**é¡¹ç›®çŠ¶æ€ï¼š** Next.js + Drizzle ORM å…¨æ ˆåº”ç”¨

