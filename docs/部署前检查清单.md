# éƒ¨ç½²å‰æ£€æŸ¥æ¸…å•

## âœ… æœ¬åœ°å‡†å¤‡ï¼ˆåœ¨ä»£ç æ¨é€å‰å®Œæˆï¼‰

### 1. ç¯å¢ƒå˜é‡é…ç½®
```bash
# å¤åˆ¶ç¯å¢ƒå˜é‡æ¨¡æ¿
cp .env.example .env.local

# ç¼–è¾‘ .env.local æ–‡ä»¶ï¼Œè®¾ç½®å¼€å‘ç¯å¢ƒå˜é‡
AUTH_SECRET=your-generated-secret-key
DATABASE_PATH=./db.sqlite
NEXTAUTH_URL=http://localhost:3000
```

**æ³¨æ„**: `.env.local` ä¸ä¼šè¢«æäº¤åˆ°Gitï¼Œåªç”¨äºæœ¬åœ°å¼€å‘

### 2. æœ¬åœ°æµ‹è¯•
```bash
# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
cd frontend
pnpm dev

# æµ‹è¯•åŸºæœ¬åŠŸèƒ½
curl http://localhost:3000/api/health
```

### 3. ä»£ç æäº¤
```bash
# ç¡®ä¿æ‰€æœ‰æ–‡ä»¶éƒ½å·²æäº¤
git add .
git commit -m "å‡†å¤‡ç”Ÿäº§éƒ¨ç½²"
git push origin main
```

## ğŸ”§ GitHub é…ç½®ï¼ˆä¸€æ¬¡æ€§è®¾ç½®ï¼‰

### 1. è®¾ç½® Repository Secrets
åœ¨ GitHub ä»“åº“ **Settings > Secrets and variables > Actions** ä¸­æ·»åŠ ï¼š

```
SERVER_IP         # æœåŠ¡å™¨å…¬ç½‘IP
SERVER_USER       # SSHç”¨æˆ·åï¼ˆé€šå¸¸æ˜¯ root æˆ– ubuntuï¼‰
SERVER_PASSWORD   # SSHå¯†ç 
AUTH_SECRET       # NextAuthå¯†é’¥ï¼ˆopenssl rand -base64 32 ç”Ÿæˆï¼‰
DATABASE_PATH     # æ•°æ®åº“è·¯å¾„ï¼ˆ/app/db/db.production.sqlite3ï¼‰
NEXTAUTH_URL      # ç”Ÿäº§ç¯å¢ƒURLï¼ˆhttps://39.107.126.13 ä½¿ç”¨è‡ªç­¾åè¯ä¹¦ï¼‰
DOMAIN_NAME       # åŸŸåæˆ–IPåœ°å€ï¼ˆ39.107.126.13ï¼‰
```

### 2. éªŒè¯ Secrets
- [ ] `SERVER_IP` å¯ä»¥pingé€š
- [ ] `SERVER_USER` å’Œ `SERVER_PASSWORD` å¯ä»¥SSHç™»å½•
- [ ] `DOMAIN_NAME` DNSè§£ææ­£ç¡®

## ğŸ–¥ï¸ æœåŠ¡å™¨è¦æ±‚ï¼ˆä¸€æ¬¡æ€§è®¾ç½®ï¼‰

### 1. ç³»ç»Ÿè¦æ±‚
- [ ] Ubuntu/Debian/CentOS æœåŠ¡å™¨
- [ ] è‡³å°‘ 2GB RAMï¼Œ10GB ç£ç›˜ç©ºé—´
- [ ] ç¨³å®šçš„ç½‘ç»œè¿æ¥
- [ ] å¯ä»¥SSHè®¿é—®çš„è´¦æˆ·

### 2. è‡ªåŠ¨å®‰è£…è¯´æ˜

**æ³¨æ„**: CI/CDéƒ¨ç½²æ—¶ä¼šè‡ªåŠ¨å®‰è£…Dockerå’ŒDocker Composeï¼Œæ— éœ€æ‰‹åŠ¨å®‰è£…ã€‚
```bash
# å®‰è£… Docker
curl -fsSL https://get.docker.com -o get-docker.sh
sudo sh get-docker.sh

# å®‰è£… Docker Compose
sudo curl -L "https://github.com/docker/compose/releases/latest/download/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose

# æ·»åŠ ç”¨æˆ·åˆ° docker ç»„ï¼ˆå¦‚æœä¸æ˜¯rootç”¨æˆ·ï¼‰
sudo usermod -aG docker $USER
```

### 3. åå‘ä»£ç†é…ç½®

**æ³¨æ„**: CI/CDéƒ¨ç½²æ—¶ä¼šè‡ªåŠ¨é…ç½®Traefikåå‘ä»£ç†ï¼Œæ— éœ€æ‰‹åŠ¨é…ç½®ã€‚

### 4. ç›®å½•ç»“æ„

**æ³¨æ„**: CI/CDéƒ¨ç½²æ—¶ä¼šè‡ªåŠ¨åˆ›å»ºæ­£ç¡®çš„ç›®å½•ç»“æ„ï¼š
```
/home/${SERVER_USER}/gymapp/
â””â”€â”€ frontend/
    â””â”€â”€ deploy/
        â”œâ”€â”€ db/           # æ•°æ®åº“ç›®å½•ï¼ˆè‡ªåŠ¨åˆ›å»ºï¼‰
        â””â”€â”€ ...
```

### 5. ç½‘ç»œé…ç½®

ç¡®ä¿æœåŠ¡å™¨çš„ç½‘ç»œé…ç½®æ­£ç¡®ï¼š
- [ ] SSHç«¯å£(22)å¯ä»¥è®¿é—®
- [ ] HTTPç«¯å£(80)å’ŒHTTPSç«¯å£(443)æœªè¢«é˜²ç«å¢™é˜»æ­¢
- [ ] åŸŸåDNSè§£ææ­£ç¡®æŒ‡å‘æœåŠ¡å™¨IP

## ğŸš€ éƒ¨ç½²æµç¨‹

### ç¬¬1æ¬¡éƒ¨ç½²
```bash
# æ¨é€ä»£ç åˆ° main åˆ†æ”¯ä¼šè‡ªåŠ¨è§¦å‘éƒ¨ç½²
git push origin main

# ç›‘æ§éƒ¨ç½²è¿‡ç¨‹
# åœ¨ GitHub Actions é¡µé¢æŸ¥çœ‹éƒ¨ç½²æ—¥å¿—
```

### åç»­éƒ¨ç½²
```bash
# ä»»ä½•æ¨é€åˆ° main çš„ä»£ç éƒ½ä¼šè‡ªåŠ¨éƒ¨ç½²
git add .
git commit -m "æ›´æ–°å†…å®¹"
git push origin main
```

## ğŸ” éªŒè¯éƒ¨ç½²

### 1. æ£€æŸ¥æœåŠ¡çŠ¶æ€
```bash
# SSH åˆ°æœåŠ¡å™¨
ssh user@your-server-ip

# æ£€æŸ¥å®¹å™¨çŠ¶æ€
docker ps

# æ£€æŸ¥åº”ç”¨æ—¥å¿—
docker logs gymapp-frontend

# æ£€æŸ¥æ•°æ®åº“
sqlite3 ~/gymapp/frontend/deploy/db/db.production.sqlite3 ".tables"
```

### 2. æµ‹è¯•åº”ç”¨
```bash
# æµ‹è¯•å¥åº·æ£€æŸ¥
curl https://yourdomain.com/api/health

# æµ‹è¯•åº”ç”¨è®¿é—®
# æ‰“å¼€æµè§ˆå™¨è®¿é—® https://yourdomain.com
```

## ğŸ› ï¸ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. SSH è¿æ¥å¤±è´¥
```bash
# æ£€æŸ¥æœåŠ¡å™¨IPå’Œç«¯å£
ping your-server-ip

# æµ‹è¯•SSHè¿æ¥
ssh -T user@your-server-ip

# æ£€æŸ¥é˜²ç«å¢™
sudo ufw status
```

#### 2. Docker æƒé™é—®é¢˜
```bash
# ç¡®ä¿ç”¨æˆ·åœ¨ docker ç»„ä¸­
groups $USER

# å¦‚æœä¸åœ¨ï¼Œæ·»åŠ ç”¨æˆ·
sudo usermod -aG docker $USER
# é‡æ–°ç™»å½•æˆ–è¿è¡Œ: newgrp docker
```

#### 3. Traefik é…ç½®é—®é¢˜
```bash
# æ£€æŸ¥ Traefik æ—¥å¿—
cd ~/traefik
docker-compose logs

# æ£€æŸ¥ç½‘ç»œ
docker network ls | grep traefik
```

#### 4. SSL è¯ä¹¦é—®é¢˜
```bash
# æ£€æŸ¥ ACME æ–‡ä»¶æƒé™
ls -la ~/traefik/acme.json

# æ£€æŸ¥åŸŸå DNS
nslookup yourdomain.com
```

## ğŸ“‹ éƒ¨ç½²çŠ¶æ€æ£€æŸ¥æ¸…å•

### âœ… å‡†å¤‡é˜¶æ®µ
- [ ] æœ¬åœ°ç¯å¢ƒå˜é‡é…ç½®å®Œæˆ
- [ ] ä»£ç æµ‹è¯•é€šè¿‡
- [ ] GitHub Secrets é…ç½®å®Œæˆ

### âœ… æœåŠ¡å™¨é…ç½®
- [ ] Docker å’Œ Docker Compose å®‰è£…å®Œæˆ
- [ ] Traefik è¿è¡Œæ­£å¸¸
- [ ] åº”ç”¨ç›®å½•åˆ›å»ºå®Œæˆ
- [ ] é˜²ç«å¢™é…ç½®æ­£ç¡®

### âœ… é¦–æ¬¡éƒ¨ç½²
- [ ] ä»£ç æ¨é€è§¦å‘ Git Action
- [ ] éƒ¨ç½²è¿‡ç¨‹æ— é”™è¯¯
- [ ] åº”ç”¨å¯æ­£å¸¸è®¿é—®
- [ ] æ•°æ®åº“åˆå§‹åŒ–å®Œæˆ

### âœ… ç”Ÿäº§éªŒè¯
- [ ] HTTPS è¯ä¹¦æ­£å¸¸
- [ ] ç”¨æˆ·æ³¨å†Œ/ç™»å½•åŠŸèƒ½æ­£å¸¸
- [ ] æ•°æ®æŒä¹…åŒ–æ­£å¸¸

---

## ğŸ¯ å¿«é€Ÿå¼€å§‹æ€»ç»“

å¦‚æœæ‚¨å·²ç»æœ‰ä¸€å°é…ç½®å¥½çš„æœåŠ¡å™¨ï¼Œåªéœ€è¦ï¼š

1. **é…ç½® GitHub Secrets**ï¼ˆ5ä¸ªå¿…éœ€çš„ç¯å¢ƒå˜é‡ï¼‰
2. **æ¨é€ä»£ç **ï¼š`git push origin main`
3. **ç­‰å¾…éƒ¨ç½²å®Œæˆ**ï¼ˆçº¦3-5åˆ†é’Ÿï¼‰
4. **è®¿é—®åº”ç”¨**ï¼š`https://yourdomain.com`

**æ³¨æ„**ï¼šæ•´ä¸ªéƒ¨ç½²è¿‡ç¨‹å®Œå…¨è‡ªåŠ¨åŒ–ï¼Œæ— éœ€æ‰‹åŠ¨åœ¨æœåŠ¡å™¨ä¸Šæ“ä½œï¼

## ğŸ” è‡ªç­¾åè¯ä¹¦é…ç½®ï¼ˆå¯é€‰ï¼‰

å¦‚æœæ‚¨æƒ³ä½¿ç”¨è‡ªç­¾åè¯ä¹¦è€Œä¸æ˜¯Let's Encryptï¼Œè¯·æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤ï¼š

### 1. ç”Ÿæˆè‡ªç­¾åè¯ä¹¦
```bash
# åœ¨æœåŠ¡å™¨ä¸Šç”Ÿæˆè‡ªç­¾åè¯ä¹¦
cd ~/traefik/certs
openssl req -x509 -newkey rsa:4096 -keyout key.pem -out cert.pem -days 365 -nodes \
  -subj "/C=CN/ST=State/L=City/O=Organization/CN=39.107.126.13"

# è®¾ç½®æ­£ç¡®æƒé™
chmod 600 key.pem cert.pem
```

### 2. æ›´æ–° Traefik é…ç½®
ç¼–è¾‘ `~/traefik/traefik.yml`ï¼Œå–æ¶ˆæ³¨é‡Šå¹¶ä¿®æ”¹TLSè¯ä¹¦éƒ¨åˆ†ï¼š

```yaml
tls:
  certificates:
    - certFile: /etc/traefik/certs/cert.pem
      keyFile: /etc/traefik/certs/key.pem
```

### 3. æ›´æ–° Docker Compose é…ç½®
åœ¨ `~/traefik/docker-compose.yml` ä¸­æ·»åŠ è¯ä¹¦å·æŒ‚è½½ï¼š

```yaml
volumes:
  - /var/run/docker.sock:/var/run/docker.sock
  - ./traefik.yml:/etc/traefik/traefik.yml
  - ./acme.json:/acme.json
  - ./certs:/etc/traefik/certs:ro  # æ·»åŠ è¿™ä¸€è¡Œ
```

### 4. é‡å¯ Traefik
```bash
cd ~/traefik
docker-compose down
docker-compose up -d
```

### 5. æµè§ˆå™¨è®¿é—®
é¦–æ¬¡è®¿é—® `https://39.107.126.13` æ—¶ï¼Œæµè§ˆå™¨ä¼šæ˜¾ç¤ºè¯ä¹¦è­¦å‘Šï¼Œç‚¹å‡»"ç»§ç»­è®¿é—®"å³å¯ã€‚

**æ³¨æ„**ï¼šè‡ªç­¾åè¯ä¹¦ä»…ç”¨äºå¼€å‘/æµ‹è¯•ç¯å¢ƒï¼Œç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨Let's Encryptæˆ–å•†ä¸šè¯ä¹¦ã€‚

---

**æœ€åæ›´æ–°ï¼š** 2026å¹´1æœˆ2æ—¥ (æ›´æ–°CI/CDéƒ¨ç½²æµç¨‹ï¼Œç§»é™¤æ‰‹åŠ¨æœåŠ¡å™¨é…ç½®)
