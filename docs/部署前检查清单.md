# éƒ¨ç½²å‰æ£€æŸ¥æ¸…å•

## âœ… æœ¬åœ°å‡†å¤‡ï¼ˆåœ¨ä»£ç æŽ¨é€å‰å®Œæˆï¼‰

### 1. çŽ¯å¢ƒå˜é‡é…ç½®
```bash
# å¤åˆ¶çŽ¯å¢ƒå˜é‡æ¨¡æ¿
cp .env.example .env.local

# ç¼–è¾‘ .env.local æ–‡ä»¶ï¼Œè®¾ç½®å¼€å‘çŽ¯å¢ƒå˜é‡
AUTH_SECRET=your-generated-secret-key
DATABASE_PATH=./db.sqlite
NEXTAUTH_URL=http://localhost:3000
```

**æ³¨æ„**: `.env.local` ä¸ä¼šè¢«æäº¤åˆ°Gitï¼Œåªç”¨äºŽæœ¬åœ°å¼€å‘

### 2. æœ¬åœ°æµ‹è¯•
```bash
# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
cd frontend
pnpm dev

# æµ‹è¯•åŸºæœ¬åŠŸèƒ½
curl http://localhost:3000/api/health
```

### 3. ä»£ç æäº¤
```bash
# ç¡®ä¿æ‰€æœ‰æ–‡ä»¶éƒ½å·²æäº¤
git add .
git commit -m "å‡†å¤‡ç”Ÿäº§éƒ¨ç½²"
git push origin main
```

## ðŸ”§ GitHub é…ç½®ï¼ˆä¸€æ¬¡æ€§è®¾ç½®ï¼‰

### 1. è®¾ç½® Repository Secrets
åœ¨ GitHub ä»“åº“ **Settings > Secrets and variables > Actions** ä¸­æ·»åŠ ï¼š

```
SERVER_IP         # æœåŠ¡å™¨å…¬ç½‘IP
SERVER_USER       # SSHç”¨æˆ·åï¼ˆé€šå¸¸æ˜¯ root æˆ– ubuntuï¼‰
SERVER_PASSWORD   # SSHå¯†ç 
AUTH_SECRET       # NextAuthå¯†é’¥ï¼ˆopenssl rand -base64 32 ç”Ÿæˆï¼‰
DATABASE_PATH     # æ•°æ®åº“è·¯å¾„ï¼ˆ/app/db/db.production.sqlite3ï¼‰
NEXTAUTH_URL      # ç”Ÿäº§çŽ¯å¢ƒURLï¼ˆhttps://39.107.126.13 ä½¿ç”¨è‡ªç­¾åè¯ä¹¦ï¼‰
DOMAIN_NAME       # åŸŸåæˆ–IPåœ°å€ï¼ˆ39.107.126.13ï¼‰
```

### 2. éªŒè¯ Secrets
- [ ] `SERVER_IP` å¯ä»¥pingé€š
- [ ] `SERVER_USER` å’Œ `SERVER_PASSWORD` å¯ä»¥SSHç™»å½•
- [ ] `DOMAIN_NAME` DNSè§£æžæ­£ç¡®

## ðŸ–¥ï¸ æœåŠ¡å™¨å‡†å¤‡ï¼ˆä¸€æ¬¡æ€§è®¾ç½®ï¼‰

### 1. ç³»ç»Ÿè¦æ±‚
- [ ] Ubuntu/Debian/CentOS æœåŠ¡å™¨
- [ ] è‡³å°‘ 2GB RAMï¼Œ10GB ç£ç›˜ç©ºé—´
- [ ] ç¨³å®šçš„ç½‘ç»œè¿žæŽ¥

### 2. å®‰è£… Docker å’Œ Docker Compose
```bash
# å®‰è£… Docker
curl -fsSL https://get.docker.com -o get-docker.sh
sudo sh get-docker.sh

# å®‰è£… Docker Compose
sudo curl -L "https://github.com/docker/compose/releases/latest/download/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose

# æ·»åŠ ç”¨æˆ·åˆ° docker ç»„ï¼ˆå¦‚æžœä¸æ˜¯rootç”¨æˆ·ï¼‰
sudo usermod -aG docker $USER
```

### 3. å®‰è£… Traefikï¼ˆåå‘ä»£ç†ï¼‰
```bash
# åˆ›å»º Traefik é…ç½®ç›®å½•
mkdir -p ~/traefik

# åˆ›å»º docker-compose.yml ç”¨äºŽ Traefik
cat > ~/traefik/docker-compose.yml << EOF
version: '3.8'
services:
  traefik:
    image: traefik:v2.10
    container_name: traefik
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - ./traefik.yml:/etc/traefik/traefik.yml
      - ./acme.json:/acme.json
    networks:
      - traefik_net
    restart: unless-stopped

networks:
  traefik_net:
    driver: bridge
EOF

# åˆ›å»º Traefik é…ç½®æ–‡ä»¶
cat > ~/traefik/traefik.yml << EOF
api:
  dashboard: true
  insecure: true

entryPoints:
  web:
    address: ":80"
    http:
      redirections:
        entryPoint:
          to: websecure
          scheme: https
  websecure:
    address: ":443"
    http:
      tls:
        # æ”¯æŒè‡ªç­¾åè¯ä¹¦ï¼Œå¦‚æžœæ²¡æœ‰Let's Encryptè¯ä¹¦
        certResolver: letsencrypt

certificatesResolvers:
  letsencrypt:
    acme:
      email: your-email@example.com
      storage: /acme.json
      httpChallenge:
        entryPoint: web

# æ·»åŠ TLSé…ç½®ä»¥æ”¯æŒè‡ªç­¾åè¯ä¹¦
tls:
  certificates:
    # å¦‚æžœæ‚¨æœ‰è‡ªç­¾åè¯ä¹¦ï¼Œå¯ä»¥åœ¨è¿™é‡Œé…ç½®
    # - certFile: /path/to/cert.pem
    #   keyFile: /path/to/key.pem

providers:
  docker:
    exposedByDefault: false
    network: traefik_net
EOF

# åˆ›å»º ACME æ–‡ä»¶ï¼ˆSSLè¯ä¹¦å­˜å‚¨ï¼‰
touch ~/traefik/acme.json
chmod 600 ~/traefik/acme.json

# å¯é€‰ï¼šå¦‚æžœè¦ä½¿ç”¨è‡ªç­¾åè¯ä¹¦ï¼Œå–æ¶ˆæ³¨é‡Šå¹¶ä¿®æ”¹ä»¥ä¸‹éƒ¨åˆ†
# mkdir -p ~/traefik/certs
# cat > ~/traefik/certs/cert.pem << 'EOF'
# -----BEGIN CERTIFICATE-----
# æ‚¨çš„è‡ªç­¾åè¯ä¹¦å†…å®¹
# -----END CERTIFICATE-----
# EOF
#
# cat > ~/traefik/certs/key.pem << 'EOF'
# -----BEGIN PRIVATE KEY-----
# æ‚¨çš„ç§é’¥å†…å®¹
# -----END PRIVATE KEY-----
# EOF

# å¯åŠ¨ Traefik
cd ~/traefik
docker-compose up -d
```

### 4. åˆ›å»ºåº”ç”¨ç›®å½•ç»“æž„
```bash
# åˆ›å»ºåº”ç”¨ç›®å½•ï¼ˆæŒ‰ç…§ Git Action ä¸­çš„è·¯å¾„ï¼‰
mkdir -p ~/app/frontend/db
```

### 5. é…ç½®é˜²ç«å¢™
```bash
# å…è®¸ SSH (22), HTTP (80), HTTPS (443)
sudo ufw allow 22
sudo ufw allow 80
sudo ufw allow 443
sudo ufw --force enable
```

## ðŸš€ éƒ¨ç½²æµç¨‹

### ç¬¬1æ¬¡éƒ¨ç½²
```bash
# æŽ¨é€ä»£ç åˆ° main åˆ†æ”¯ä¼šè‡ªåŠ¨è§¦å‘éƒ¨ç½²
git push origin main

# ç›‘æŽ§éƒ¨ç½²è¿‡ç¨‹
# åœ¨ GitHub Actions é¡µé¢æŸ¥çœ‹éƒ¨ç½²æ—¥å¿—
```

### åŽç»­éƒ¨ç½²
```bash
# ä»»ä½•æŽ¨é€åˆ° main çš„ä»£ç éƒ½ä¼šè‡ªåŠ¨éƒ¨ç½²
git add .
git commit -m "æ›´æ–°å†…å®¹"
git push origin main
```

## ðŸ” éªŒè¯éƒ¨ç½²

### 1. æ£€æŸ¥æœåŠ¡çŠ¶æ€
```bash
# SSH åˆ°æœåŠ¡å™¨
ssh user@your-server-ip

# æ£€æŸ¥å®¹å™¨çŠ¶æ€
docker ps

# æ£€æŸ¥åº”ç”¨æ—¥å¿—
docker logs gymapp-frontend

# æ£€æŸ¥æ•°æ®åº“
sqlite3 ~/app/frontend/db/db.production.sqlite3 ".tables"
```

### 2. æµ‹è¯•åº”ç”¨
```bash
# æµ‹è¯•å¥åº·æ£€æŸ¥
curl https://yourdomain.com/api/health

# æµ‹è¯•åº”ç”¨è®¿é—®
# æ‰“å¼€æµè§ˆå™¨è®¿é—® https://yourdomain.com
```

## ðŸ› ï¸ æ•…éšœæŽ’é™¤

### å¸¸è§é—®é¢˜

#### 1. SSH è¿žæŽ¥å¤±è´¥
```bash
# æ£€æŸ¥æœåŠ¡å™¨IPå’Œç«¯å£
ping your-server-ip

# æµ‹è¯•SSHè¿žæŽ¥
ssh -T user@your-server-ip

# æ£€æŸ¥é˜²ç«å¢™
sudo ufw status
```

#### 2. Docker æƒé™é—®é¢˜
```bash
# ç¡®ä¿ç”¨æˆ·åœ¨ docker ç»„ä¸­
groups $USER

# å¦‚æžœä¸åœ¨ï¼Œæ·»åŠ ç”¨æˆ·
sudo usermod -aG docker $USER
# é‡æ–°ç™»å½•æˆ–è¿è¡Œ: newgrp docker
```

#### 3. Traefik é…ç½®é—®é¢˜
```bash
# æ£€æŸ¥ Traefik æ—¥å¿—
cd ~/traefik
docker-compose logs

# æ£€æŸ¥ç½‘ç»œ
docker network ls | grep traefik
```

#### 4. SSL è¯ä¹¦é—®é¢˜
```bash
# æ£€æŸ¥ ACME æ–‡ä»¶æƒé™
ls -la ~/traefik/acme.json

# æ£€æŸ¥åŸŸå DNS
nslookup yourdomain.com
```

## ðŸ“‹ éƒ¨ç½²çŠ¶æ€æ£€æŸ¥æ¸…å•

### âœ… å‡†å¤‡é˜¶æ®µ
- [ ] æœ¬åœ°çŽ¯å¢ƒå˜é‡é…ç½®å®Œæˆ
- [ ] ä»£ç æµ‹è¯•é€šè¿‡
- [ ] GitHub Secrets é…ç½®å®Œæˆ

### âœ… æœåŠ¡å™¨é…ç½®
- [ ] Docker å’Œ Docker Compose å®‰è£…å®Œæˆ
- [ ] Traefik è¿è¡Œæ­£å¸¸
- [ ] åº”ç”¨ç›®å½•åˆ›å»ºå®Œæˆ
- [ ] é˜²ç«å¢™é…ç½®æ­£ç¡®

### âœ… é¦–æ¬¡éƒ¨ç½²
- [ ] ä»£ç æŽ¨é€è§¦å‘ Git Action
- [ ] éƒ¨ç½²è¿‡ç¨‹æ— é”™è¯¯
- [ ] åº”ç”¨å¯æ­£å¸¸è®¿é—®
- [ ] æ•°æ®åº“åˆå§‹åŒ–å®Œæˆ

### âœ… ç”Ÿäº§éªŒè¯
- [ ] HTTPS è¯ä¹¦æ­£å¸¸
- [ ] ç”¨æˆ·æ³¨å†Œ/ç™»å½•åŠŸèƒ½æ­£å¸¸
- [ ] æ•°æ®æŒä¹…åŒ–æ­£å¸¸

---

## ðŸŽ¯ å¿«é€Ÿå¼€å§‹æ€»ç»“

å¦‚æžœæ‚¨å·²ç»æœ‰ä¸€å°é…ç½®å¥½çš„æœåŠ¡å™¨ï¼Œåªéœ€è¦ï¼š

1. **é…ç½® GitHub Secrets**ï¼ˆ5ä¸ªå¿…éœ€çš„çŽ¯å¢ƒå˜é‡ï¼‰
2. **æŽ¨é€ä»£ç **ï¼š`git push origin main`
3. **ç­‰å¾…éƒ¨ç½²å®Œæˆ**ï¼ˆçº¦3-5åˆ†é’Ÿï¼‰
4. **è®¿é—®åº”ç”¨**ï¼š`https://yourdomain.com`

**æ³¨æ„**ï¼šæ•´ä¸ªéƒ¨ç½²è¿‡ç¨‹å®Œå…¨è‡ªåŠ¨åŒ–ï¼Œæ— éœ€æ‰‹åŠ¨åœ¨æœåŠ¡å™¨ä¸Šæ“ä½œï¼

## ðŸ” è‡ªç­¾åè¯ä¹¦é…ç½®ï¼ˆå¯é€‰ï¼‰

å¦‚æžœæ‚¨æƒ³ä½¿ç”¨è‡ªç­¾åè¯ä¹¦è€Œä¸æ˜¯Let's Encryptï¼Œè¯·æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤ï¼š

### 1. ç”Ÿæˆè‡ªç­¾åè¯ä¹¦
```bash
# åœ¨æœåŠ¡å™¨ä¸Šç”Ÿæˆè‡ªç­¾åè¯ä¹¦
cd ~/traefik/certs
openssl req -x509 -newkey rsa:4096 -keyout key.pem -out cert.pem -days 365 -nodes \
  -subj "/C=CN/ST=State/L=City/O=Organization/CN=39.107.126.13"

# è®¾ç½®æ­£ç¡®æƒé™
chmod 600 key.pem cert.pem
```

### 2. æ›´æ–° Traefik é…ç½®
ç¼–è¾‘ `~/traefik/traefik.yml`ï¼Œå–æ¶ˆæ³¨é‡Šå¹¶ä¿®æ”¹TLSè¯ä¹¦éƒ¨åˆ†ï¼š

```yaml
tls:
  certificates:
    - certFile: /etc/traefik/certs/cert.pem
      keyFile: /etc/traefik/certs/key.pem
```

### 3. æ›´æ–° Docker Compose é…ç½®
åœ¨ `~/traefik/docker-compose.yml` ä¸­æ·»åŠ è¯ä¹¦å·æŒ‚è½½ï¼š

```yaml
volumes:
  - /var/run/docker.sock:/var/run/docker.sock
  - ./traefik.yml:/etc/traefik/traefik.yml
  - ./acme.json:/acme.json
  - ./certs:/etc/traefik/certs:ro  # æ·»åŠ è¿™ä¸€è¡Œ
```

### 4. é‡å¯ Traefik
```bash
cd ~/traefik
docker-compose down
docker-compose up -d
```

### 5. æµè§ˆå™¨è®¿é—®
é¦–æ¬¡è®¿é—® `https://39.107.126.13` æ—¶ï¼Œæµè§ˆå™¨ä¼šæ˜¾ç¤ºè¯ä¹¦è­¦å‘Šï¼Œç‚¹å‡»"ç»§ç»­è®¿é—®"å³å¯ã€‚

**æ³¨æ„**ï¼šè‡ªç­¾åè¯ä¹¦ä»…ç”¨äºŽå¼€å‘/æµ‹è¯•çŽ¯å¢ƒï¼Œç”Ÿäº§çŽ¯å¢ƒå»ºè®®ä½¿ç”¨Let's Encryptæˆ–å•†ä¸šè¯ä¹¦ã€‚
