# é¦–æ¬¡éƒ¨ç½² .env æ–‡ä»¶å¤„ç†æ–¹æ¡ˆ

## ðŸŽ¯ é—®é¢˜

é¦–æ¬¡éƒ¨ç½²æ—¶ï¼ŒæœåŠ¡å™¨ä¸Šè¿˜æ²¡æœ‰ `.env` æ–‡ä»¶ï¼Œå¦‚ä½•ä¼˜é›…åœ°å¤„ç†ï¼Ÿ

## ðŸ“‹ æ–¹æ¡ˆå¯¹æ¯”

### æ–¹æ¡ˆ 1ï¼šå‹å¥½é”™è¯¯æç¤º + è¯¦ç»†æ–‡æ¡£ï¼ˆæŽ¨èï¼‰

**å®žçŽ°æ–¹å¼**ï¼š
```yaml
# GitHub Actions ä¸­æ£€æŸ¥
cd "$DEPLOY_DIR/frontend/deploy"

if [ ! -f .env ]; then
  echo "âŒ =========================================="
  echo "âŒ .env æ–‡ä»¶ä¸å­˜åœ¨ï¼"
  echo "âŒ =========================================="
  echo ""
  echo "ðŸ“ è¯·æŒ‰ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼š"
  echo ""
  echo "1. SSH è¿žæŽ¥åˆ°æœåŠ¡å™¨ï¼š"
  echo "   ssh ${{ secrets.SERVER_USER }}@${{ secrets.SERVER_IP }}"
  echo ""
  echo "2. è¿›å…¥éƒ¨ç½²ç›®å½•ï¼š"
  echo "   cd $DEPLOY_DIR/frontend/deploy"
  echo ""
  echo "3. ä»Žæ¨¡æ¿åˆ›å»º .env æ–‡ä»¶ï¼š"
  echo "   cp .env.example .env"
  echo ""
  echo "4. ç¼–è¾‘ .env æ–‡ä»¶ï¼Œå¡«å…¥çœŸå®žå€¼ï¼š"
  echo "   nano .env"
  echo ""
  echo "5. è®¾ç½®æ–‡ä»¶æƒé™ï¼š"
  echo "   chmod 600 .env"
  echo ""
  echo "6. é‡æ–°è¿è¡Œéƒ¨ç½²æˆ–æ‰‹åŠ¨å¯åŠ¨ï¼š"
  echo "   docker compose --env-file .env up -d"
  echo ""
  echo "ðŸ“– è¯¦ç»†æ–‡æ¡£ï¼šæŸ¥çœ‹ docs/éƒ¨ç½²æŒ‡å—.md"
  echo ""
  exit 1
fi
```

**ä¼˜ç‚¹**ï¼š
- âœ… ç®€å•ç›´æŽ¥ï¼Œç¬¦åˆæ‰‹åŠ¨ç®¡ç†æ–¹æ¡ˆ
- âœ… é”™è¯¯æç¤ºæ¸…æ™°ï¼Œç”¨æˆ·çŸ¥é“è¯¥åšä»€ä¹ˆ
- âœ… ä¸éœ€è¦ GitHub Secrets å­˜å‚¨é¡¹ç›®å˜é‡
- âœ… å®Œå…¨æ‰‹åŠ¨æŽ§åˆ¶

**ç¼ºç‚¹**ï¼š
- âš ï¸ é¦–æ¬¡éƒ¨ç½²éœ€è¦ä¸¤æ­¥æ“ä½œï¼ˆåˆ›å»º .env + é‡æ–°éƒ¨ç½²ï¼‰
- âš ï¸ éœ€è¦ç”¨æˆ·æ‰‹åŠ¨æ“ä½œ

**é€‚ç”¨åœºæ™¯**ï¼š
- âœ… å•æœåŠ¡å™¨éƒ¨ç½²
- âœ… å°å›¢é˜Ÿï¼ˆ1-3äººï¼‰
- âœ… å¸Œæœ›å®Œå…¨æ‰‹åŠ¨æŽ§åˆ¶

---

### æ–¹æ¡ˆ 2ï¼šé¦–æ¬¡è‡ªåŠ¨åˆ›å»ºæ¨¡æ¿ï¼Œæç¤ºå¡«å†™

**å®žçŽ°æ–¹å¼**ï¼š
```yaml
cd "$DEPLOY_DIR/frontend/deploy"

if [ ! -f .env ]; then
  echo "ðŸ“ é¦–æ¬¡éƒ¨ç½²ï¼Œåˆ›å»º .env æ¨¡æ¿æ–‡ä»¶..."
  
  # ä»Ž .env.example åˆ›å»ºï¼ˆå¦‚æžœå­˜åœ¨ï¼‰
  if [ -f .env.example ]; then
    cp .env.example .env
    echo "âœ… å·²ä»Ž .env.example åˆ›å»º .env æ–‡ä»¶"
  else
    # åˆ›å»ºåŸºç¡€æ¨¡æ¿
    cat > .env << 'ENVEOF'
# GymApp ç”Ÿäº§çŽ¯å¢ƒé…ç½®
# è¯·ç¼–è¾‘æ­¤æ–‡ä»¶ï¼Œå¡«å…¥çœŸå®žå€¼

AUTH_SECRET=è¯·æ›¿æ¢ä¸ºä½ çš„å¯†é’¥
POSTGRES_PASSWORD=è¯·æ›¿æ¢ä¸ºæ•°æ®åº“å¯†ç 
NEXTAUTH_URL=https://yourdomain.com
DOMAIN_NAME=yourdomain.com
NODE_ENV=production
ENVEOF
    echo "âœ… å·²åˆ›å»º .env æ¨¡æ¿æ–‡ä»¶"
  fi
  
  chmod 600 .env
  
  echo ""
  echo "âš ï¸  =========================================="
  echo "âš ï¸  è¯·ç¼–è¾‘ .env æ–‡ä»¶å¹¶å¡«å…¥çœŸå®žå€¼ï¼"
  echo "âš ï¸  =========================================="
  echo ""
  echo "SSH åˆ°æœåŠ¡å™¨æ‰§è¡Œï¼š"
  echo "  cd $DEPLOY_DIR/frontend/deploy"
  echo "  nano .env"
  echo ""
  echo "ç¼–è¾‘å®ŒæˆåŽï¼Œé‡æ–°è¿è¡Œéƒ¨ç½²æˆ–æ‰§è¡Œï¼š"
  echo "  docker compose --env-file .env up -d"
  echo ""
  exit 1
fi
```

**ä¼˜ç‚¹**ï¼š
- âœ… è‡ªåŠ¨åˆ›å»ºæ¨¡æ¿ï¼Œå‡å°‘æ‰‹åŠ¨æ“ä½œ
- âœ… ç”¨æˆ·åªéœ€è¦å¡«å†™å€¼ï¼Œä¸éœ€è¦åˆ›å»ºæ–‡ä»¶
- âœ… ä»ç„¶ä¿æŒæ‰‹åŠ¨ç®¡ç†çš„çµæ´»æ€§

**ç¼ºç‚¹**ï¼š
- âš ï¸ é¦–æ¬¡éƒ¨ç½²ä»éœ€è¦ä¸¤æ­¥ï¼ˆå¡«å†™ + é‡æ–°éƒ¨ç½²ï¼‰
- âš ï¸ éœ€è¦ç”¨æˆ·çŸ¥é“å¦‚ä½•ç¼–è¾‘æ–‡ä»¶

**é€‚ç”¨åœºæ™¯**ï¼š
- âœ… å¸Œæœ›å‡å°‘é¦–æ¬¡éƒ¨ç½²çš„æ‰‹åŠ¨æ­¥éª¤
- âœ… ä»ç„¶å¸Œæœ›æ‰‹åŠ¨æŽ§åˆ¶é…ç½®å€¼

---

### æ–¹æ¡ˆ 3ï¼šé¦–æ¬¡ä»Ž GitHub Secrets åˆ›å»ºï¼ŒåŽç»­æ‰‹åŠ¨ç®¡ç†ï¼ˆæ··åˆæ–¹æ¡ˆï¼‰

**å®žçŽ°æ–¹å¼**ï¼š
```yaml
cd "$DEPLOY_DIR/frontend/deploy"

if [ ! -f .env ]; then
  echo "ðŸ“ é¦–æ¬¡éƒ¨ç½²ï¼Œä»Ž GitHub Secrets åˆ›å»º .env æ–‡ä»¶..."
  
  # é¦–æ¬¡ä»Ž Secrets åˆ›å»ºï¼ˆéœ€è¦ä¸´æ—¶æ·»åŠ  Secretsï¼‰
  cat > .env << 'ENVEOF'
AUTH_SECRET=${{ secrets.AUTH_SECRET }}
POSTGRES_PASSWORD=${{ secrets.POSTGRES_PASSWORD }}
NEXTAUTH_URL=${{ secrets.NEXTAUTH_URL }}
DOMAIN_NAME=${{ secrets.DOMAIN_NAME }}
NODE_ENV=production
ENVEOF
  
  chmod 600 .env
  echo "âœ… .env æ–‡ä»¶å·²åˆ›å»º"
  echo "ðŸ’¡ åŽç»­å¦‚éœ€æ›´æ–°ï¼Œè¯·æ‰‹åŠ¨ç¼–è¾‘æœåŠ¡å™¨ä¸Šçš„ .env æ–‡ä»¶"
else
  echo "âœ… .env æ–‡ä»¶å·²å­˜åœ¨ï¼Œä¿æŒä¸å˜"
fi

# ä½¿ç”¨ .env å¯åŠ¨
docker compose --env-file .env up -d
```

**ä¼˜ç‚¹**ï¼š
- âœ… é¦–æ¬¡éƒ¨ç½²å®Œå…¨è‡ªåŠ¨åŒ–
- âœ… åŽç»­æ‰‹åŠ¨ç®¡ç†ï¼Œä¸ä¼šè¢«è¦†ç›–
- âœ… å¹³è¡¡è‡ªåŠ¨åŒ–å’Œçµæ´»æ€§

**ç¼ºç‚¹**ï¼š
- âš ï¸ é¦–æ¬¡ä»éœ€è¦ GitHub Secretsï¼ˆä½†åªç”¨ä¸€æ¬¡ï¼‰
- âš ï¸ å¦‚æžœ Secrets æ›´æ–°ï¼Œä¸ä¼šè‡ªåŠ¨åŒæ­¥åˆ°æœåŠ¡å™¨

**é€‚ç”¨åœºæ™¯**ï¼š
- âœ… å¸Œæœ›é¦–æ¬¡éƒ¨ç½²è‡ªåŠ¨åŒ–
- âœ… åŽç»­é…ç½®æ‰‹åŠ¨ç®¡ç†
- âœ… å¯ä»¥æŽ¥å—é¦–æ¬¡ä½¿ç”¨ GitHub Secrets

---

### æ–¹æ¡ˆ 4ï¼šéƒ¨ç½²å‰æ£€æŸ¥è„šæœ¬ï¼ˆæœ€ä¸¥æ ¼ï¼‰

**å®žçŽ°æ–¹å¼**ï¼š
```yaml
# åœ¨éƒ¨ç½²å‰æ£€æŸ¥
- name: Pre-deployment checks
  run: |
    sshpass -p "${{ secrets.SERVER_PASSWORD }}" ssh ... << 'EOF'
      DEPLOY_DIR="/home/${{ secrets.SERVER_USER }}/gymapp"
      
      # æ£€æŸ¥ .env æ–‡ä»¶
      if [ ! -f "$DEPLOY_DIR/frontend/deploy/.env" ]; then
        echo "âŒ .env æ–‡ä»¶ä¸å­˜åœ¨"
        echo "è¯·å…ˆåˆ›å»º .env æ–‡ä»¶ï¼ˆå‚è€ƒéƒ¨ç½²æ–‡æ¡£ï¼‰"
        exit 1
      fi
      
      # æ£€æŸ¥å¿…éœ€çš„çŽ¯å¢ƒå˜é‡
      source "$DEPLOY_DIR/frontend/deploy/.env"
      required_vars=("AUTH_SECRET" "POSTGRES_PASSWORD" "NEXTAUTH_URL" "DOMAIN_NAME")
      missing_vars=()
      
      for var in "${required_vars[@]}"; do
        if [ -z "${!var}" ] || [[ "${!var}" == *"è¯·æ›¿æ¢"* ]] || [[ "${!var}" == *"your"* ]]; then
          missing_vars+=("$var")
        fi
      done
      
      if [ ${#missing_vars[@]} -gt 0 ]; then
        echo "âŒ ä»¥ä¸‹çŽ¯å¢ƒå˜é‡æœªæ­£ç¡®è®¾ç½®ï¼š"
        printf '   - %s\n' "${missing_vars[@]}"
        echo "è¯·ç¼–è¾‘ .env æ–‡ä»¶å¹¶å¡«å…¥çœŸå®žå€¼"
        exit 1
      fi
      
      echo "âœ… éƒ¨ç½²å‰æ£€æŸ¥é€šè¿‡"
    EOF
```

**ä¼˜ç‚¹**ï¼š
- âœ… æœ€ä¸¥æ ¼ï¼Œç¡®ä¿é…ç½®æ­£ç¡®
- âœ… æå‰å‘çŽ°é—®é¢˜ï¼Œä¸æµªè´¹æž„å»ºæ—¶é—´
- âœ… éªŒè¯çŽ¯å¢ƒå˜é‡å€¼ï¼ˆä¸åªæ˜¯å­˜åœ¨ï¼‰

**ç¼ºç‚¹**ï¼š
- âš ï¸ å¢žåŠ éƒ¨ç½²å¤æ‚åº¦
- âš ï¸ éœ€è¦ç»´æŠ¤æ£€æŸ¥é€»è¾‘

**é€‚ç”¨åœºæ™¯**ï¼š
- âœ… éœ€è¦ä¸¥æ ¼çš„é…ç½®éªŒè¯
- âœ… å¤šçŽ¯å¢ƒéƒ¨ç½²
- âœ… å›¢é˜Ÿåä½œï¼Œéœ€è¦ç¡®ä¿é…ç½®æ­£ç¡®

---

## ðŸŽ¯ æŽ¨èæ–¹æ¡ˆå¯¹æ¯”

| æ–¹æ¡ˆ | é¦–æ¬¡éƒ¨ç½² | åŽç»­ç®¡ç† | å¤æ‚åº¦ | æŽ¨èåº¦ |
|------|----------|----------|--------|--------|
| 1. å‹å¥½é”™è¯¯æç¤º | æ‰‹åŠ¨åˆ›å»º | æ‰‹åŠ¨ç®¡ç† | â­ | â­â­â­â­â­ |
| 2. è‡ªåŠ¨åˆ›å»ºæ¨¡æ¿ | è‡ªåŠ¨åˆ›å»º+æ‰‹åŠ¨å¡«å†™ | æ‰‹åŠ¨ç®¡ç† | â­â­ | â­â­â­â­ |
| 3. é¦–æ¬¡ä»Ž Secrets | è‡ªåŠ¨åˆ›å»º | æ‰‹åŠ¨ç®¡ç† | â­â­ | â­â­â­â­ |
| 4. éƒ¨ç½²å‰æ£€æŸ¥ | æ‰‹åŠ¨åˆ›å»º+éªŒè¯ | æ‰‹åŠ¨ç®¡ç† | â­â­â­ | â­â­â­ |

---

## ðŸ’¡ æˆ‘çš„å»ºè®®

åŸºäºŽä½ é€‰æ‹©çš„**æ‰‹åŠ¨ç®¡ç†æ–¹æ¡ˆ**ï¼ŒæŽ¨èï¼š

### é¦–é€‰ï¼šæ–¹æ¡ˆ 2ï¼ˆè‡ªåŠ¨åˆ›å»ºæ¨¡æ¿ + å‹å¥½æç¤ºï¼‰

**ç†ç”±**ï¼š
1. âœ… å‡å°‘é¦–æ¬¡éƒ¨ç½²çš„æ‰‹åŠ¨æ­¥éª¤ï¼ˆä¸éœ€è¦æ‰‹åŠ¨åˆ›å»ºæ–‡ä»¶ï¼‰
2. âœ… ä»ç„¶ä¿æŒæ‰‹åŠ¨ç®¡ç†çš„çµæ´»æ€§
3. âœ… ä¸éœ€è¦ GitHub Secrets å­˜å‚¨é¡¹ç›®å˜é‡
4. âœ… ç®€å•å®žç”¨ï¼Œç¬¦åˆä½ çš„éœ€æ±‚

**å®žæ–½æ­¥éª¤**ï¼š
1. åˆ›å»º `.env.example` æ¨¡æ¿ï¼ˆæäº¤åˆ° Gitï¼‰
2. GitHub Actions æ£€æŸ¥ï¼Œå¦‚æžœä¸å­˜åœ¨åˆ™è‡ªåŠ¨åˆ›å»º
3. æä¾›æ¸…æ™°çš„é”™è¯¯æç¤ºå’Œæ“ä½œæŒ‡å¼•
4. ç”¨æˆ·å¡«å†™åŽé‡æ–°éƒ¨ç½²æˆ–æ‰‹åŠ¨å¯åŠ¨

### å¤‡é€‰ï¼šæ–¹æ¡ˆ 1ï¼ˆçº¯æ‰‹åŠ¨ + å‹å¥½æç¤ºï¼‰

**å¦‚æžœæ›´å€¾å‘äºŽå®Œå…¨æ‰‹åŠ¨æŽ§åˆ¶**ï¼š
- ä¸è‡ªåŠ¨åˆ›å»ºæ–‡ä»¶
- æä¾›è¯¦ç»†çš„é”™è¯¯æç¤ºå’Œæ–‡æ¡£
- ç”¨æˆ·å®Œå…¨æ‰‹åŠ¨æ“ä½œ

---

## ðŸ“ å®žæ–½å»ºè®®

### 1. åˆ›å»º `.env.example` æ¨¡æ¿

```bash
# frontend/deploy/.env.example
# GymApp ç”Ÿäº§çŽ¯å¢ƒé…ç½®æ¨¡æ¿
# å¤åˆ¶æ­¤æ–‡ä»¶ä¸º .env å¹¶å¡«å…¥çœŸå®žå€¼

# NextAuth è®¤è¯å¯†é’¥ï¼ˆç”Ÿæˆå‘½ä»¤ï¼šopenssl rand -base64 32ï¼‰
AUTH_SECRET=your-auth-secret-here

# PostgreSQL æ•°æ®åº“å¯†ç 
POSTGRES_PASSWORD=your-postgres-password-here

# åº”ç”¨è®¿é—® URL
NEXTAUTH_URL=https://yourdomain.com

# åŸŸåï¼ˆç”¨äºŽ Traefikï¼‰
DOMAIN_NAME=yourdomain.com

# çŽ¯å¢ƒç±»åž‹
NODE_ENV=production
```

### 2. æ›´æ–° GitHub Actions

```yaml
cd "$DEPLOY_DIR/frontend/deploy"

# æ£€æŸ¥ .env æ–‡ä»¶
if [ ! -f .env ]; then
  echo "ðŸ“ é¦–æ¬¡éƒ¨ç½²ï¼Œåˆ›å»º .env æ¨¡æ¿..."
  
  if [ -f .env.example ]; then
    cp .env.example .env
    chmod 600 .env
    echo "âœ… å·²ä»Ž .env.example åˆ›å»º .env æ–‡ä»¶"
  else
    echo "âŒ .env.example æ¨¡æ¿æ–‡ä»¶ä¸å­˜åœ¨"
    exit 1
  fi
  
  echo ""
  echo "âš ï¸  =========================================="
  echo "âš ï¸  è¯·ç¼–è¾‘ .env æ–‡ä»¶å¹¶å¡«å…¥çœŸå®žå€¼ï¼"
  echo "âš ï¸  =========================================="
  echo ""
  echo "æ“ä½œæ­¥éª¤ï¼š"
  echo "1. SSH åˆ°æœåŠ¡å™¨ï¼š"
  echo "   ssh ${{ secrets.SERVER_USER }}@${{ secrets.SERVER_IP }}"
  echo ""
  echo "2. ç¼–è¾‘ .env æ–‡ä»¶ï¼š"
  echo "   cd $DEPLOY_DIR/frontend/deploy"
  echo "   nano .env"
  echo ""
  echo "3. å¡«å…¥æ‰€æœ‰å¿…éœ€çš„å€¼åŽï¼Œé‡æ–°è¿è¡Œéƒ¨ç½²"
  echo ""
  exit 1
fi

# éªŒè¯ .env æ–‡ä»¶ä¸ä¸ºç©ºæ¨¡æ¿
if grep -q "your-.*-here\|è¯·æ›¿æ¢" .env; then
  echo "âš ï¸  .env æ–‡ä»¶åŒ…å«æ¨¡æ¿å ä½ç¬¦ï¼Œè¯·å¡«å…¥çœŸå®žå€¼"
  exit 1
fi

# ä½¿ç”¨ .env å¯åŠ¨
docker compose --env-file .env up -d
```

### 3. æ›´æ–°éƒ¨ç½²æ–‡æ¡£

åœ¨éƒ¨ç½²æ–‡æ¡£ä¸­æ˜Žç¡®è¯´æ˜Žï¼š
- é¦–æ¬¡éƒ¨ç½²éœ€è¦åˆ›å»º .env æ–‡ä»¶
- å¦‚ä½•ä»Žæ¨¡æ¿åˆ›å»º
- éœ€è¦å¡«å†™å“ªäº›å€¼
- å¦‚ä½•éªŒè¯é…ç½®æ­£ç¡®

---

## ðŸ¤” ä½ çš„é€‰æ‹©

1. **æ–¹æ¡ˆ 2**ï¼ˆè‡ªåŠ¨åˆ›å»ºæ¨¡æ¿ï¼‰â€” æŽ¨èï¼Œå‡å°‘é¦–æ¬¡éƒ¨ç½²æ­¥éª¤
2. **æ–¹æ¡ˆ 1**ï¼ˆçº¯æ‰‹åŠ¨ï¼‰â€” å¦‚æžœä½ æ›´å€¾å‘äºŽå®Œå…¨æ‰‹åŠ¨æŽ§åˆ¶
3. **æ–¹æ¡ˆ 3**ï¼ˆé¦–æ¬¡ä»Ž Secretsï¼‰â€” å¦‚æžœä½ å¸Œæœ›é¦–æ¬¡å®Œå…¨è‡ªåŠ¨åŒ–
4. **æ–¹æ¡ˆ 4**ï¼ˆéƒ¨ç½²å‰æ£€æŸ¥ï¼‰â€” å¦‚æžœä½ éœ€è¦ä¸¥æ ¼çš„éªŒè¯

ä½ å€¾å‘äºŽå“ªä¸ªæ–¹æ¡ˆï¼Ÿ

