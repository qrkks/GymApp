# æµ‹è¯•è§„èŒƒç¬¦åˆæ€§æ£€æŸ¥æŠ¥å‘Š

## æ£€æŸ¥æ—¶é—´
2025å¹´1æœˆ

## è§„èŒƒä¾æ®
- `docs/é¡¹ç›®è§„èŒƒ.md` - ç¬¬4èŠ‚ï¼šæµ‹è¯•è§„èŒƒ
- `frontend/tests/README.md` - æ•°æ®åº“éš”ç¦»ç­–ç•¥

---

## âœ… ç¬¦åˆè§„èŒƒçš„éƒ¨åˆ†

### 1. æµ‹è¯•æ–‡ä»¶ä½ç½®
- âœ… æ‰€æœ‰æµ‹è¯•æ–‡ä»¶éƒ½ä½¿ç”¨ `__tests__` ç›®å½•ç»“æ„
- âœ… æµ‹è¯•æ–‡ä»¶å‘½åç¬¦åˆè§„èŒƒï¼š`*.test.ts`

### 2. æµ‹è¯•å‘½å
- âœ… æµ‹è¯•ç”¨ä¾‹ä½¿ç”¨ `should {expected behavior} when {condition}` æ ¼å¼
- âœ… ä¾‹å¦‚ï¼š`should return success with empty array when no body parts exist`

### 3. æµ‹è¯•ç»“æ„
- âœ… ä½¿ç”¨ AAA æ¨¡å¼ï¼ˆArrange â†’ Act â†’ Assertï¼‰
- âœ… ä½¿ç”¨ `describe` å’Œ `it` ç»„ç»‡æµ‹è¯•

### 4. æ•°æ®åº“éš”ç¦»ï¼ˆâœ… å®Œå…¨ç¬¦åˆï¼‰
- âœ… Repository å±‚æµ‹è¯•å·²è¿ç§»åˆ°æ–°çš„éš”ç¦»æ–¹å¼
- âœ… æ‰€æœ‰ Use Case æµ‹è¯•å·²è¿ç§»åˆ°æ–°çš„éš”ç¦»æ–¹å¼
- âœ… æ‰€æœ‰ API è·¯ç”±æµ‹è¯•ä½¿ç”¨æ–°çš„éš”ç¦»æ–¹å¼

---

## âŒ ä¸ç¬¦åˆè§„èŒƒçš„éƒ¨åˆ†

### 1. æ•°æ®åº“éš”ç¦»æ–¹å¼ï¼ˆâœ… å·²ä¿®å¤ï¼‰

**çŠ¶æ€ï¼š** âœ… å·²å®Œæˆä¿®å¤

**å·²ä¿®å¤æ–‡ä»¶ï¼š**
1. âœ… `frontend/domain/body-part/application/__tests__/body-part.use-case.test.ts`
2. âœ… `frontend/domain/exercise/application/__tests__/exercise.use-case.test.ts`

**å½“å‰ä»£ç ï¼š**
```typescript
// âŒ æ—§æ–¹å¼
import { getTestDb } from '@/tests/setup/test-db';

jest.mock('@/lib/db', () => {
  const { getTestDb } = require('@/tests/setup/test-db');
  return {
    db: getTestDb(),  // âŒ æœªä½¿ç”¨ __filename
  };
});

describe('Test Suite', () => {
  const db = getTestDb();  // âŒ æœªä½¿ç”¨ __filename
  // âŒ ç¼ºå°‘ afterAll cleanupTestDb
});
```

**åº”æ”¹ä¸ºï¼š**
```typescript
// âœ… æ–°æ–¹å¼
import { createTestDb, cleanupTestDb } from '@/tests/setup/test-db';

jest.mock('@/lib/db', () => ({
  db: createTestDb(__filename),  // âœ… ä½¿ç”¨ __filename
}));

describe('Test Suite', () => {
  const db = createTestDb(__filename);  // âœ… ä½¿ç”¨ __filename
  
  afterAll(async () => {
    await cleanupTestDb(__filename);  // âœ… å¿…é¡»æ¸…ç†
  });
});
```

**ä¼˜å…ˆçº§ï¼š** ğŸ”´ é«˜ï¼ˆå½±å“æµ‹è¯•éš”ç¦»ï¼‰

---

### 2. API è·¯ç”±æµ‹è¯•ç¼ºå¤±ï¼ˆä¸¥é‡ï¼‰

**é—®é¢˜ï¼š** è§„èŒƒè¦æ±‚é›†æˆæµ‹è¯•åº”åŒ…å« "API è·¯ç”±å¤„ç†"ï¼Œä½†å¤§éƒ¨åˆ† API è·¯ç”±éƒ½æ²¡æœ‰æµ‹è¯•ã€‚

**å½“å‰çŠ¶æ€ï¼š**
- âœ… å·²æœ‰ï¼š9ä¸ª API è·¯ç”±æµ‹è¯•æ–‡ä»¶
- âŒ ç¼ºå¤±ï¼š11+ ä¸ª API è·¯ç”±

**å·²å®Œæˆçš„ API è·¯ç”±æµ‹è¯•ï¼š**

#### 2.1 Body Part API âœ…
- âœ… `app/api/body-part/route.ts` (GET, POST, DELETE)
- âœ… `app/api/body-part/[id]/route.ts` (PATCH, DELETE)

#### 2.2 Exercise API âœ…
- âœ… `app/api/exercise/route.ts` (GET, POST, DELETE)
- âœ… `app/api/exercise/[id]/route.ts` (PATCH, DELETE)

#### 2.3 User API âœ…
- âœ… `app/api/user/me/route.ts` (GET)
- âœ… `app/api/user/profile/route.ts` (PUT)
- âœ… `app/api/user/password/route.ts` (PUT)

#### 2.4 Set API âœ…
- âœ… `app/api/set/route.ts` (GET)
- âœ… `app/api/set/[id]/route.ts` (PUT, DELETE)

**ç¼ºå¤±çš„ API è·¯ç”±æµ‹è¯•ï¼š**

#### 2.5 Workout API
- âŒ `app/api/workout/route.ts`
- âŒ `app/api/workout/[date]/route.ts`
- âŒ `app/api/workout/[date]/body-parts/route.ts`
- âŒ `app/api/workout/[date]/remove-body-parts/route.ts`
- âŒ `app/api/workout/last/sets/route.ts`
- âŒ `app/api/workout/last/sets/first/route.ts`

#### 2.6 Exercise Block API
- âŒ `app/api/exercise-block/route.ts`
- âŒ `app/api/exercise-block/[date]/[exercise]/route.ts`

#### 2.7 Auth API
- âŒ `app/api/auth/signup/route.ts`
- âŒ `app/api/auth/[...nextauth]/route.ts`

**ä¼˜å…ˆçº§ï¼š** ğŸ”´ é«˜ï¼ˆè¿™æ˜¯å¯¼è‡´ JSON åºåˆ—åŒ–é”™è¯¯ç­‰é›†æˆé—®é¢˜æœªè¢«å‘ç°çš„ä¸»è¦åŸå› ï¼‰

---

### 3. E2E æµ‹è¯•å®Œå…¨ç¼ºå¤±

**é—®é¢˜ï¼š** è§„èŒƒè¦æ±‚æµ‹è¯•é‡‘å­—å¡”ä¸­ 10% åº”ä¸º E2E æµ‹è¯•ï¼Œä½†å½“å‰å®Œå…¨æ²¡æœ‰ã€‚

**è§„èŒƒè¦æ±‚ï¼š**
```
        /\
       /E2E\          â† 10% ç«¯åˆ°ç«¯æµ‹è¯•
      /------\
     /Integration\    â† 20% é›†æˆæµ‹è¯•
    /------------\
   /   Unit Tests   \ â† 70% å•å…ƒæµ‹è¯•
  /------------------\
```

**å½“å‰çŠ¶æ€ï¼š**
- âŒ `frontend/e2e/` ç›®å½•ä¸ºç©º
- âŒ æ²¡æœ‰ä»»ä½• E2E æµ‹è¯•

**å»ºè®®çš„ E2E æµ‹è¯•åœºæ™¯ï¼š**
1. ç”¨æˆ·æ³¨å†Œå’Œç™»å½•æµç¨‹
2. åˆ›å»ºè®­ç»ƒéƒ¨ä½å’ŒåŠ¨ä½œ
3. åˆ›å»ºè®­ç»ƒè®¡åˆ’å¹¶æ·»åŠ ç»„
4. è®°å½•è®­ç»ƒæ•°æ®
5. æŸ¥çœ‹å†å²è®­ç»ƒè®°å½•

**ä¼˜å…ˆçº§ï¼š** ğŸŸ¡ ä¸­ï¼ˆE2E æµ‹è¯•æˆæœ¬è¾ƒé«˜ï¼Œä½†èƒ½å‘ç°é›†æˆé—®é¢˜ï¼‰

---

### 4. API è·¯ç”±æµ‹è¯•ä¸å®Œæ•´

**é—®é¢˜ï¼š** å³ä½¿å·²æœ‰çš„ API è·¯ç”±æµ‹è¯•ä¹Ÿä¸å®Œæ•´ã€‚

**å½“å‰ï¼š** `app/api/exercise/[id]/__tests__/route.test.ts`
- âœ… æµ‹è¯•äº† DELETE æ–¹æ³•
- âŒ æœªæµ‹è¯• PATCH æ–¹æ³•ï¼ˆæ›´æ–°åŠ¨ä½œåç§°ï¼‰

**åº”æµ‹è¯•çš„å†…å®¹ï¼š**
- âœ… HTTP æ–¹æ³•ï¼ˆGET, POST, PATCH, DELETEï¼‰
- âœ… è¯·æ±‚å‚æ•°éªŒè¯
- âœ… è®¤è¯å’Œæˆæƒ
- âœ… æˆåŠŸå“åº”æ ¼å¼
- âœ… é”™è¯¯å“åº”æ ¼å¼
- âœ… JSON åºåˆ—åŒ–ï¼ˆç¡®ä¿æ‰€æœ‰å“åº”éƒ½æ˜¯æœ‰æ•ˆçš„ JSONï¼‰
- âœ… HTTP çŠ¶æ€ç 
- âœ… Content-Type å¤´

**ä¼˜å…ˆçº§ï¼š** ğŸŸ¡ ä¸­ï¼ˆå·²æœ‰éƒ¨åˆ†æµ‹è¯•ï¼Œéœ€è¦å®Œå–„ï¼‰

---

### 5. æµ‹è¯•è¦†ç›–ç‡æœªçŸ¥

**é—®é¢˜ï¼š** æœªæ£€æŸ¥æµ‹è¯•è¦†ç›–ç‡æ˜¯å¦ç¬¦åˆè§„èŒƒè¦æ±‚ã€‚

**å»ºè®®ï¼š**
- è¿è¡Œ `pnpm test:coverage` æ£€æŸ¥è¦†ç›–ç‡
- ç¡®ä¿æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼ˆUse Case å±‚ï¼‰è¦†ç›–ç‡ > 80%
- ç¡®ä¿é¢†åŸŸæ¨¡å‹ï¼ˆEntityã€Value Objectï¼‰è¦†ç›–ç‡ > 90%

**ä¼˜å…ˆçº§ï¼š** ğŸŸ¢ ä½ï¼ˆéœ€è¦å…ˆå®Œå–„æµ‹è¯•ï¼‰

---

## ğŸ“Š ç»Ÿè®¡æ‘˜è¦

| ç±»åˆ« | ç¬¦åˆ | ä¸ç¬¦åˆ | ç¼ºå¤± |
|------|------|--------|------|
| æµ‹è¯•æ–‡ä»¶ä½ç½® | âœ… | - | - |
| æµ‹è¯•å‘½å | âœ… | - | - |
| æµ‹è¯•ç»“æ„ | âœ… | - | - |
| æ•°æ®åº“éš”ç¦» | 12/12 âœ… | 0/12 | - |
| API è·¯ç”±æµ‹è¯• | 9/20+ | - | 11+ |
| E2E æµ‹è¯• | - | - | å…¨éƒ¨ |
| **æ€»è®¡** | **~75%** | **~0%** | **~25%** |

### æ›´æ–°è®°å½•ï¼ˆ2025å¹´1æœˆï¼‰

**å·²ä¿®å¤ï¼š**
- âœ… æ•°æ®åº“éš”ç¦»æ–¹å¼ï¼š2ä¸ªæ–‡ä»¶å·²è¿ç§»åˆ°æ–°æ–¹å¼
- âœ… Body Part APIï¼š2ä¸ªæµ‹è¯•æ–‡ä»¶ï¼ˆGET, POST, DELETE, PATCHï¼‰
- âœ… Exercise APIï¼š2ä¸ªæµ‹è¯•æ–‡ä»¶ï¼ˆGET, POST, DELETE, PATCHï¼‰
- âœ… User APIï¼š3ä¸ªæµ‹è¯•æ–‡ä»¶ï¼ˆme, profile, passwordï¼‰
- âœ… Set APIï¼š2ä¸ªæµ‹è¯•æ–‡ä»¶ï¼ˆGET, PUT, DELETEï¼‰

**å½“å‰çŠ¶æ€ï¼š**
- æ•°æ®åº“éš”ç¦»ï¼š100% ç¬¦åˆè§„èŒƒ
- API è·¯ç”±æµ‹è¯•ï¼šä» 5% æå‡åˆ° 45%

---

## ğŸ¯ ä¿®å¤ä¼˜å…ˆçº§

### ğŸ”´ é«˜ä¼˜å…ˆçº§ï¼ˆâœ… å·²å®Œæˆï¼‰
1. âœ… **è¿ç§»å‰©ä½™çš„ 2 ä¸ª Use Case æµ‹è¯•åˆ°æ–°çš„æ•°æ®åº“éš”ç¦»æ–¹å¼**
   - âœ… `body-part.use-case.test.ts`
   - âœ… `exercise.use-case.test.ts`

2. âœ… **ä¸ºå…³é”® API è·¯ç”±æ·»åŠ é›†æˆæµ‹è¯•**
   - âœ… Body Part APIï¼ˆCRUDï¼‰
   - âœ… Exercise APIï¼ˆå®Œå–„ç°æœ‰ï¼Œæ·»åŠ ç¼ºå¤±ï¼‰
   - âœ… User APIï¼ˆè®¤è¯ç›¸å…³ï¼‰
   - âœ… Set APIï¼ˆCRUDï¼‰

### ğŸŸ¡ ä¸­ä¼˜å…ˆçº§ï¼ˆè¿›è¡Œä¸­ï¼‰
3. âœ… **å®Œå–„ API è·¯ç”±æµ‹è¯•**
   - âœ… ç¡®ä¿æ‰€æœ‰ HTTP æ–¹æ³•éƒ½æœ‰æµ‹è¯•
   - âœ… ç¡®ä¿é”™è¯¯åœºæ™¯éƒ½æœ‰æµ‹è¯•
   - âœ… ç¡®ä¿ JSON åºåˆ—åŒ–éƒ½æœ‰éªŒè¯
   - â³ ä¸ºå‰©ä½™ API è·¯ç”±æ·»åŠ æµ‹è¯•ï¼ˆWorkout, Exercise Block, Authï¼‰

4. **æ·»åŠ åŸºç¡€ E2E æµ‹è¯•**
   - å…³é”®ç”¨æˆ·æµç¨‹ï¼ˆæ³¨å†Œã€ç™»å½•ã€åˆ›å»ºè®­ç»ƒï¼‰

### ğŸŸ¢ ä½ä¼˜å…ˆçº§ï¼ˆé•¿æœŸè§„åˆ’ï¼‰
5. **æµ‹è¯•è¦†ç›–ç‡ä¼˜åŒ–**
   - è¾¾åˆ°è§„èŒƒè¦æ±‚çš„è¦†ç›–ç‡ç›®æ ‡
   - æŒç»­ç›‘æ§è¦†ç›–ç‡

---

## ğŸ“ ä¿®å¤å»ºè®®

### ä¿®å¤æ­¥éª¤ 1ï¼šè¿ç§»æ•°æ®åº“éš”ç¦»æ–¹å¼

**æ–‡ä»¶ï¼š** `frontend/domain/body-part/application/__tests__/body-part.use-case.test.ts`

**ä¿®æ”¹ï¼š**
```typescript
// ä¿®æ”¹å¯¼å…¥
- import { getTestDb } from '@/tests/setup/test-db';
+ import { createTestDb, cleanupTestDb } from '@/tests/setup/test-db';

// ä¿®æ”¹ Mock
jest.mock('@/lib/db', () => {
-  const { getTestDb } = require('@/tests/setup/test-db');
+  const { createTestDb } = require('@/tests/setup/test-db');
  return {
-    db: getTestDb(),
+    db: createTestDb(__filename),
  };
});

// ä¿®æ”¹æµ‹è¯•ä»£ç 
describe('BodyPart Application Service', () => {
-  const db = getTestDb();
+  const db = createTestDb(__filename);
  
+  afterAll(async () => {
+    await cleanupTestDb(__filename);
+  });
```

**åŒæ ·ä¿®æ”¹ï¼š** `frontend/domain/exercise/application/__tests__/exercise.use-case.test.ts`

### ä¿®å¤æ­¥éª¤ 2ï¼šæ·»åŠ  API è·¯ç”±æµ‹è¯•

**å‚è€ƒæ¨¡æ¿ï¼š** `frontend/app/api/exercise/[id]/__tests__/route.test.ts`

**éœ€è¦åˆ›å»ºçš„æµ‹è¯•æ–‡ä»¶ï¼š**
1. `app/api/body-part/__tests__/route.test.ts`
2. `app/api/body-part/[id]/__tests__/route.test.ts`
3. `app/api/exercise/__tests__/route.test.ts`
4. `app/api/exercise/[id]/__tests__/route.test.ts`ï¼ˆå®Œå–„ PATCH æ–¹æ³•ï¼‰
5. ...ï¼ˆå…¶ä»– API è·¯ç”±ï¼‰

### ä¿®å¤æ­¥éª¤ 3ï¼šæ·»åŠ  E2E æµ‹è¯•

**å»ºè®®ä½¿ç”¨ï¼š** Playwright æˆ– Cypress

**åˆ›å»ºæ–‡ä»¶ï¼š** `frontend/e2e/user-flow.test.ts`

**æµ‹è¯•åœºæ™¯ï¼š**
- ç”¨æˆ·æ³¨å†Œ â†’ ç™»å½• â†’ åˆ›å»ºè®­ç»ƒéƒ¨ä½ â†’ åˆ›å»ºåŠ¨ä½œ â†’ åˆ›å»ºè®­ç»ƒè®¡åˆ’

---

## ğŸ“š å‚è€ƒæ–‡æ¡£

- [é¡¹ç›®è§„èŒƒ - æµ‹è¯•è§„èŒƒ](../é¡¹ç›®è§„èŒƒ.md#4-æµ‹è¯•è§„èŒƒ)
- [æµ‹è¯•è®¾ç½®æŒ‡å—](../../frontend/tests/README.md)
- [API è·¯ç”±æµ‹è¯•ç¤ºä¾‹](../../frontend/app/api/exercise/[id]/__tests__/route.test.ts)

---

**æœ€åæ›´æ–°ï¼š** 2025å¹´1æœˆ

