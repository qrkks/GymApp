# åŠ è½½çŠ¶æ€è®¾è®¡æ–¹æ¡ˆ

## ğŸ“‹ è®¾è®¡ç›®æ ‡

1. **ç»Ÿä¸€çš„åŠ è½½ä½“éªŒ**ï¼šæ‰€æœ‰é¡µé¢ä½¿ç”¨ä¸€è‡´çš„åŠ è½½çŠ¶æ€
2. **ç”¨æˆ·å‹å¥½**ï¼šä½¿ç”¨ Skeleton å ä½ç¬¦ï¼Œè€Œä¸æ˜¯ç®€å•çš„ Spinner
3. **æ€§èƒ½ä¼˜åŒ–**ï¼šåŒºåˆ†åˆå§‹åŠ è½½å’Œé‡æ–°éªŒè¯
4. **æ˜“äºä½¿ç”¨**ï¼šæä¾›å¯å¤ç”¨çš„ç»„ä»¶å’Œ Hook

---

## ğŸ¨ è®¾è®¡æ–¹æ¡ˆ

### 1. ç»„ä»¶å±‚æ¬¡

```
components/
â”œâ”€â”€ ui/
â”‚   â”œâ”€â”€ skeleton.tsx          # Skeleton åŸºç¡€ç»„ä»¶ï¼ˆshadcn/uiï¼‰
â”‚   â””â”€â”€ spinner.tsx           # Spinner ç»„ä»¶ï¼ˆå¯é€‰ï¼‰
â”œâ”€â”€ loading/
â”‚   â”œâ”€â”€ PageSkeleton.tsx      # é¡µé¢çº§ Skeleton
â”‚   â”œâ”€â”€ WorkoutSkeleton.tsx   # è®­ç»ƒé¡µé¢ Skeleton
â”‚   â”œâ”€â”€ ExerciseLibrarySkeleton.tsx  # åŠ¨ä½œåº“ Skeleton
â”‚   â””â”€â”€ TableSkeleton.tsx     # è¡¨æ ¼ Skeleton
â””â”€â”€ LoadingWrapper.tsx         # åŠ è½½çŠ¶æ€åŒ…è£…ç»„ä»¶
```

### 2. Hook è®¾è®¡

```typescript
// hooks/useLoadingState.ts
export function useLoadingState<T>(
  data: T | undefined,
  error: Error | undefined,
  isLoading: boolean,
  isValidating: boolean
) {
  const isInitialLoading = isLoading && !data;
  const isRefreshing = isValidating && data;
  
  return {
    isInitialLoading,
    isRefreshing,
    hasError: !!error,
    hasData: !!data,
  };
}
```

### 3. ä½¿ç”¨åœºæ™¯

#### åœºæ™¯ 1ï¼šé¡µé¢åˆå§‹åŠ è½½
- **æ˜¾ç¤º**ï¼šé¡µé¢çº§ Skeleton
- **éšè—**ï¼šé¡µé¢å†…å®¹

#### åœºæ™¯ 2ï¼šæ•°æ®åˆ·æ–°ï¼ˆå·²æœ‰æ•°æ®ï¼‰
- **æ˜¾ç¤º**ï¼šé¡¶éƒ¨åŠ è½½æŒ‡ç¤ºå™¨ï¼ˆå¯é€‰ï¼‰
- **ä¿æŒ**ï¼šç°æœ‰å†…å®¹å¯è§

#### åœºæ™¯ 3ï¼šè¡¨æ ¼/åˆ—è¡¨åŠ è½½
- **æ˜¾ç¤º**ï¼šè¡¨æ ¼è¡Œ Skeleton
- **éšè—**ï¼šè¡¨æ ¼å†…å®¹

#### åœºæ™¯ 4ï¼šæŒ‰é’®/æ“ä½œåŠ è½½
- **æ˜¾ç¤º**ï¼šæŒ‰é’®å†… Spinner + ç¦ç”¨çŠ¶æ€
- **æ–‡æœ¬**ï¼šæ˜¾ç¤º"åŠ è½½ä¸­..."

---

## ğŸ› ï¸ å®ç°æ­¥éª¤

### æ­¥éª¤ 1ï¼šæ·»åŠ  Skeleton ç»„ä»¶

ä½¿ç”¨ shadcn/ui æ·»åŠ  Skeleton ç»„ä»¶ï¼š

```bash
npx shadcn@latest add skeleton
```

### æ­¥éª¤ 2ï¼šåˆ›å»ºåŠ è½½çŠ¶æ€ Hook

åˆ›å»º `hooks/useLoadingState.ts` ç”¨äºç»Ÿä¸€ç®¡ç†åŠ è½½çŠ¶æ€ã€‚

### æ­¥éª¤ 3ï¼šåˆ›å»º Skeleton ç»„ä»¶

ä¸ºä¸åŒé¡µé¢åˆ›å»ºå¯¹åº”çš„ Skeleton ç»„ä»¶ã€‚

### æ­¥éª¤ 4ï¼šæ›´æ–°é¡µé¢ç»„ä»¶

åœ¨æ‰€æœ‰ä½¿ç”¨ SWR çš„é¡µé¢ä¸­ï¼š
1. ä½¿ç”¨ `isLoading` åˆ¤æ–­åˆå§‹åŠ è½½
2. ä½¿ç”¨ `isValidating` åˆ¤æ–­åˆ·æ–°çŠ¶æ€
3. æ˜¾ç¤ºå¯¹åº”çš„ Skeleton

### æ­¥éª¤ 5ï¼šåˆ›å»º LoadingWrapper

åˆ›å»ºç»Ÿä¸€çš„åŠ è½½çŠ¶æ€åŒ…è£…ç»„ä»¶ï¼Œç®€åŒ–ä½¿ç”¨ã€‚

---

## ğŸ“ ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹ 1ï¼šè®­ç»ƒè¯¦æƒ…é¡µé¢

```tsx
const { data, error, isLoading, isValidating } = useSWR(...);
const { isInitialLoading, isRefreshing } = useLoadingState(data, error, isLoading, isValidating);

if (isInitialLoading) {
  return <WorkoutSkeleton />;
}

if (error) {
  return <ErrorDisplay error={error} />;
}

return (
  <div>
    {isRefreshing && <RefreshIndicator />}
    <WorkoutContent data={data} />
  </div>
);
```

### ç¤ºä¾‹ 2ï¼šåŠ¨ä½œåº“é¡µé¢

```tsx
const { data, error, isLoading } = useSWR(...);

if (isLoading) {
  return <ExerciseLibrarySkeleton />;
}

if (error) {
  return <ErrorDisplay error={error} />;
}

return <ExerciseLibraryContent data={data} />;
```

### ç¤ºä¾‹ 3ï¼šæŒ‰é’®åŠ è½½çŠ¶æ€

```tsx
const [loading, setLoading] = useState(false);

<Button disabled={loading}>
  {loading ? (
    <>
      <Spinner className="mr-2" />
      ä¿å­˜ä¸­...
    </>
  ) : (
    'ä¿å­˜'
  )}
</Button>
```

---

## ğŸ¯ ä¼˜å…ˆçº§

### é«˜ä¼˜å…ˆçº§
1. âœ… æ·»åŠ  Skeleton ç»„ä»¶
2. âœ… åˆ›å»º useLoadingState Hook
3. âœ… æ›´æ–°è®­ç»ƒè¯¦æƒ…é¡µé¢
4. âœ… æ›´æ–°åŠ¨ä½œåº“é¡µé¢

### ä¸­ä¼˜å…ˆçº§
5. âš ï¸ åˆ›å»ºé¡µé¢çº§ Skeleton ç»„ä»¶
6. âš ï¸ æ›´æ–°è®­ç»ƒåˆ—è¡¨é¡µé¢
7. âš ï¸ æ·»åŠ åˆ·æ–°æŒ‡ç¤ºå™¨

### ä½ä¼˜å…ˆçº§
8. ğŸ”µ åˆ›å»º LoadingWrapper ç»„ä»¶
9. ğŸ”µ æ·»åŠ æŒ‰é’® Spinner
10. ğŸ”µ ä¼˜åŒ–åŠ è½½åŠ¨ç”»

---

## ğŸ“Š é¢„æœŸæ•ˆæœ

### æ”¹è¿›å‰
- âŒ é¡µé¢åŠ è½½æ—¶æ˜¾ç¤ºç©ºç™½
- âŒ ç”¨æˆ·ä¸çŸ¥é“æ•°æ®æ˜¯å¦åœ¨åŠ è½½
- âŒ åˆ·æ–°æ—¶æ²¡æœ‰è§†è§‰åé¦ˆ

### æ”¹è¿›å
- âœ… é¡µé¢åŠ è½½æ—¶æ˜¾ç¤º Skeleton
- âœ… ç”¨æˆ·æ¸…æ¥šçŸ¥é“æ•°æ®æ­£åœ¨åŠ è½½
- âœ… åˆ·æ–°æ—¶æœ‰æ˜ç¡®çš„è§†è§‰åé¦ˆ
- âœ… ç»Ÿä¸€çš„åŠ è½½ä½“éªŒ

---

## ğŸ”„ åç»­ä¼˜åŒ–

1. **éª¨æ¶å±åŠ¨ç”»**ï¼šæ·»åŠ è„‰å†²åŠ¨ç”»æ•ˆæœ
2. **æ¸è¿›å¼åŠ è½½**ï¼šå…ˆæ˜¾ç¤ºéƒ¨åˆ†å†…å®¹ï¼Œå†åŠ è½½å‰©ä½™å†…å®¹
3. **é¢„åŠ è½½**ï¼šåœ¨ç”¨æˆ·å¯èƒ½è®¿é—®çš„é¡µé¢é¢„åŠ è½½æ•°æ®
4. **ç¼“å­˜ç­–ç•¥**ï¼šä¼˜åŒ– SWR ç¼“å­˜é…ç½®

